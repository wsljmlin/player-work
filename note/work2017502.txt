2014/05/02 8:30-21:27
bug142712
 MediaUtils: new limits: 367638920/4294967295
05-02 05:14:05.981 22124 22124 W /system/bin/mediaextractor: libminijail: allowing syscall: clock_gettime
05-02 05:14:05.981 22124 22124 W /system/bin/mediaextractor: libminijail: allowing syscall: connect
05-02 05:14:05.981 22124 22124 W /system/bin/mediaextractor: libminijail: allowing syscall: fcntl64
05-02 05:14:05.981 22124 22124 W /system/bin/mediaextractor: libminijail: allowing syscall: socket
05-02 05:14:05.981 22124 22124 W /system/bin/mediaextractor: libminijail: allowing syscall: writev
05-02 05:14:05.982 22124 22124 W /system/bin/mediaextractor: libminijail: logging seccomp filter failures

05-02 04:37:48.012  3972  3972 D         : version=12 12 numInts=35,numFds=2, 2 magic=51647890,51647890
05-02 04:37:48.012  3972  3972 D         : cmp=0 0 0
05-02 04:37:48.028  3998  3998 E media.extractor: libminijail: blocked syscall: gettimeofday
使用gettimeofday引入bug
mediaextractor加载时gettimeofday是禁止的，使用clock_gettime替代


bug 143532
重新烧6.0程序

1，usb burning uboot->update

modified:   ../../amffmpeg/libavformat/asfdec.c
#       modified:   ../../amffmpeg/libavformat/aviobuf.c
#       modified:   ../../amffmpeg/libavformat/utils.c

PD#143532:fix the bug that some mwa video seek slow

Affected Repositories:
  http://scgit.amlogic.com:8080/22575

Fix Summary:
  PD#143532  :fix the bug that some mwa video seek slow

Reviewer(s) Requested:
   jian.wang@amlogic.com
   
Testing Suggestion:
	1.merge the difference
	2.compile libavformat in path "vendor/amlogic/frameworks/av/LibPlayer/amffmpeg/libavformat"
	3.compile libamplayer.so in path "vendor/amlogic/frameworks/av/LibPlayer/amplayer/player"
	4.replace compiled libamplayer.so in board and restart
	
bug 143451
setprop libc.debug.malloc.options "backtrace=1 free_track_backtrace_num_frames=16 leak_track"
setprop libc.debug.malloc.program mediaserver


2014/05/03 8:40-20:15
bug 143451
setprop libc.debug.malloc.options "backtrace=1 free_track_backtrace_num_frames=16 leak_track"
setprop libc.debug.malloc.program media.extractor


valgrind --leak-check=full --log-file=/data/valgrind3.log mediaextractor &

18:40开始煲机，20:01误关机，session20170503_1.log test.log
重新煲机 20:04 session20170503_2.log test_2.log -----9:16



2017/05/04 9:15-21:00
setprop libc.debug.malloc 1
setprop libc.debug.malloc.options leak_track
setprop libc.debug.malloc.program media.extractor
setprop libc.debug.malloc.program mediaextractor

valgrind --tool=memcheck --leak-check=yes --show-reachable=yes --log-file=/data/valgrind3.log  mediaextractor & 一用就出错

am dumpheap -n mediaextractor /data/local/tmp/subheap.hprof


setprop libc.debug.malloc.options backtrace
setprop libc.debug.malloc 1
dumpsys media.player -m 
setprop libc.debug.malloc.options "backtrace=1 free_track_backtrace_num_frames=16 leak_track"
setprop libc.debug.malloc.program media.extractor

setprop libc.debug.malloc 10

dumpsys meminfo mediaextractor
dumpsys  media.extractor -m

Amluser88!!

煲机
20:22-20:55
修改后两次煲机  av_free(st->parser);
        st->parser = NULL;
		
2017/05/05 9:10-21:00

1.
编译 ffmpeg
libstagefright
libmedia no
mediaextractor


showmap  pid

煲机 20:20 - 9:00 (20170508)


2017/05/08 8:50-20:10

2017/05/09 8:55-19:20
1.只有在视频切换时，才主动切换对应的音频

modified:   ../../AmFFmpegAdapter/extractor/AmFFmpegExtractor.cpp
#       modified:   AmGenericSource.cpp
#       modified:   AmNuPlayer.cpp
#       modified:   mediainfo.h
bug141792ok 切换ok，但数组结构有待于修改
bug141792ok2 切换ok，数组结构修改ok，但在app内部调用会出错

2017/05/10 8:55-19：30

Affected Repositories:
  http://scgit.amlogic.com:8080/22575

Fix Summary:
  PD#141792  :fix the bug that audio cannot correctly switch when switch program for multi prgrame ts

Reviewer(s) Requested:
   jian.wang@amlogic.com
   
Testing Suggestion:
	1.merge the difference
	2.compile libamffmpeg.so in path "vendor/amlogic/frameworks/av/AmFFmpegAdapter"
	3.compile libamnuplayer.so in path "vendor/amlogic/frameworks/av/media/Am-NuPlayer"
	4.replace compiled libamplayer.so in board and restart
	
发现libplayer和nuplayer有两个现象：
1.切换节目后，audio option中的音频的选项不能对应的切换=》需要app端更新mediainfo信息
2.切换节目后，audio option中的音频的索引不对 =》需要app端使用当前节目对应的音频索引


setprop libc.debug.malloc 1
setprop libc.debug.malloc.options leak_track
setprop libc.debug.malloc.options backtrace
setprop libc.debug.malloc.options "backtrace=6 leak_track"
dumpsys media.extractor -m

2017/05/11 13：00-21:05 搬家，不能考勤了
1.
setprop media.amnuplayer.localplay true
setprop media.omx.display_mode 1

显示视频位置
cat /sys/class/video/axis
cat /sys/class/video/screen_mode

logcat -s amavutils

煲机开始 21:00
17552   119284K   10828K    8092K    7364K  media.extractor

煲机结束 9:12
17552   187892K   61456K   58657K   57912K  media.extractor


2017/05/12 9:10-22:10
1. Bug 141875 - {HDR}使用Amnuplayer播放任意HDR片源，调节画面比例为4：3后，底部出现OSD遮挡。100%复现，对比Amnuplayer false后显示正常 （Wang shuanglong）
2. Bug 143843 - {AV} Trunk autobuild20170429开始播放HLS V5视频过程中会停止播放，并提示can't play this video 概率：100％ 对比：trunk0428正常（Wang shuanglong）

git clone ssh://jian.wang@scgit.amlogic.com:29418/av-restricted/platform/hardware/amlogic/omx

am start -n com.android.gallery3d/com.android.gallery3d.app.MovieActivity http://10.68.11.54:8000/huaxida/test.m3u8
内存问题，从smps中可以看出，是libc的malloc引起的



2017/05/13 13:20-16:40
用5.log可以看出app层并未计算错误 “after”


2017/05/15 9:00-20:40
1.添加kprogrameNum的tag
2.内存泄露问题，打印所的内存申请，一一去分析
setprop libc.debug.malloc 1
setprop libc.debug.malloc.options backtrace
setprop libc.debug.malloc.options "backtrace=10 leak_track"

dumpsys media.extractor -m

3.新版本，问题重现
14:55 - 15:55
6037   109408K   11040K    6199K    4952K  media.extractor
---
6037   123752K   18880K   14005K   12744K  media.extractor

4.测试半小时，dump出map表,5分钟一次，播放中的，第一次是未播放的
source mkmap.sh 6037 1 
16:45 - 17:15
之后，现过半小时再测一次，到17:45
source mkmap.sh 6037 8

1）从20之后，开始测播放退出
2）从30开始，开如测试resume现退出

=》
1）发现有些相临近差512k，这可能是个突破口

5.dump出media.extractor的内存表，分析多次申请情况


6037   292712K  134692K  132883K  132732K       0K       0K       0K       0K  media.extractor

dumpsys media.extractor -m > mem_1.log


20170516 9:20-19:50
1.
valgrind --leak-check=full  mediaextractor &


adb shell stop
adb shell setprop libc.debug.malloc 1
adb shell start
Enable malloc debug for a particular process:
adb shell setprop libc.debug.malloc.program ls
adb shell setprop libc.debug.malloc 10
adb shell ls /data/local/tmp


2.19:40-9:26
5707   106888K    9896K    5050K    3780K  media.extractor
-----
5707   196056K   63344K   60519K   59332K  media.extractor

2017/05/17 9:25-19:10
1. 不使用ffmpegextractor
10:38-13:14
16611    56584K    8292K    4491K    3556K  media.extractor
-------
16611    59928K    8084K    4237K    3300K  media.extractor


2.
13:25-14:02
11699    38332K    5636K    2034K    1396K       0K       0K       0K       0K  media.extractor
----
11699   38332K    5636K    2031K    1396K       0K       0K       0K       0K  media.extractor

14:05-14:35
11778    38332K    5640K    2035K    1400K       0K       0K       0K       0K  media.extractor
----
29410    38332K    5640K    2034K    1400K       0K       0K       0K       0K  media.extractor

14:42-15:35
5473    38328K    5640K    1864K    1456K  media.extractor
----
14525   38328K    5640K    1848K    1456K  media.extractor
内存的bug基本解决

3.bug144374: {HDR}在MoviePlayer播放部分HDR 1000的视频文件，画面有明显卡顿，播放出现掉帧不流畅现象。100%复现，对比LG电视播放正常

2017/05/18 9:13-20:50
1.

2017/05/19 9:05-10:05
4100   107372K   10540K    5742K    4484K  media.extractor
---
4100   118644K   15100K   10301K    9044K  media.extractor

10:11-12:17
863   106220K   11296K    6559K    5332K  media.extractor
----
863   126708K   19580K   14843K   13616K  media.extractor


2.使用CJ_HDR.ts，试播放前后的内存
18749   125576K   21212K   16507K   15356K  media.extractor --1.log
18749   141960K   17864K   13159K   12008K  media.extractor --2.log
18749   142088K   22936K   18224K   17072K  media.extractor --3.log
18749   142088K   22928K   18216K   17064K  media.extractor --4.log
18749   142088K   20652K   15940K   14788K  media.extractor --5.log
18749   149256K   11052K    6340K    5188K  media.extractor --6.log
18749   150280K   21912K   17200K   16048K  media.extractor --7.log
18749   150280K   15320K   10608K    9456K  media.extractor --8.log

3.使用4.mp4，试播放前后的内存(短时间)
27797   106376K   10900K    6072K    4816K  media.extractor --1.log
27797   113032K   10808K    5980K    4724K  media.extractor --2.log
27797   115592K   10264K    5436K    4180K  media.extractor --3.log
27797   115592K   10548K    5720K    4464K  media.extractor --4.log
27797   115592K   10572K    5744K    4488K  media.extractor --5.log
27797   115592K   10616K    5788K    4532K  media.extractor --6.log
27797   115592K   10624K    5796K    4540K  media.extractor --7.log
27797   118152K   10152K    5324K    4068K  media.extractor --8.log

4.使用4.mp4，试播放前后的内存(长时间，即将放完)
7251   106760K    9320K    4499K    3244K  media.extractor --1.log
7251   109320K   10040K    5219K    3964K  media.extractor --2.log
7251   115080K    9952K    5124K    3868K  media.extractor --3.log
7251   115080K   10024K    5196K    3940K  media.extractor --4.log
7251   115080K   10420K    5592K    4336K  media.extractor --5.log


5.使用4.mp4，试播放前后的内存(播放一遍)
30667   109448K   10472K    5644K    4388K  media.extractor --1.log
30667   115080K   11244K    6416K    5160K  media.extractor --2.log
30667   115080K   10384K    5556K    4300K  media.extractor --3.log
30667   115080K   12344K    7516K    6260K  media.extractor --4.log
30667   115080K   11444K    6616K    5360K  media.extractor --5.log
30667   115080K   11348K    6520K    5264K  media.extractor --6.log
30667   115592K   12008K    7180K    5924K  media.extractor --7.log
30667   115592K   11616K    6788K    5532K  media.extractor --8.log


6.
echo 0 > /proc/sys/kernel/printk

cat /proc/sys/kernel/printk
echo "7       4       1       7" > /proc/sys/kernel/printk

echo 1 > /sys/module/amvideo/parameters/force_vskip_cnt  带宽检测 抽帧1/2
echo 2 > /sys/module/amvideo/parameters/force_vskip_cnt      3/4
去除打印，视频基本就不卡了，怎么解决再定

7.baoji
2017/05/19 20:27-2017/05/21 13:47

1779   344308K  170828K  168517K  167748K  media.extractor

2017/05/21 13:45-18:20
05/22 9:20
4113   206196K   73072K   70704K   69908K  media.extractor


2. 2017/05/22 9:15-20:55
1.not ffmepg extractor 
12:08-
4111    55532K    7872K    3514K    2628K  media.extractor
-----
4111    58228K    8652K    4246K    3360K  media.extractor


grep -rnI "realease_seq" 20170522_12.log  >20170522_12 realease.log
  683  grep -rnI "realease_seq" 20170522_12.log  >20170522_12_realease.log
  684  grep -rnI "alloc_seq" 20170522_12.log  >20170522_12_alloc.log

706  cat 20170522_12_realease.log | awk  '//{print $8 $9 $10 $11 $12}'
  707  cat 20170522_12_realease.log | awk  '//{print $8 $9 $10 $11 $12}' | sort
  708  cat 20170522_12_realease.log | awk  '//{print $8 $9 $10 $11 $12}' | sort
  709  cat 20170522_12_realease.log | awk  '//{print $8 $9 $10 $11 $12}' | sort > 20170522_12_realease_sort.log
  
使用新的ffmpeg
 19:11-
 drivers/amlogic/amports/vdec_input.c
 
 2017/05/23 9:00-20:05
 
 1.9:52-10：33
6031    38172K    5388K    1696K    1332K  media.extractor
  ------
6031   117484K   11756K    6854K    5448K  media.extractor

10:56-13:17
7736    38172K    5388K    1697K    1332K  media.extractor
----
7736   122612K   12544K    7640K    6236K  media.extracto

PD#143451:fix the bug that medidaextractor memory leak

2.bug144680
PD#144680:fix the bug that video apk stop when select programe which have not service name

3.bug144374  {HDR}在MoviePlayer播放部分HDR 1000的视频文件，画面有明显卡顿，播放出现掉帧不流畅现象

2017/05/24 9:20-21:10


2017/05/25 9:26-22:10

2017/05/26 9:45-21:05
! [remote rejected] n-amlogic -> refs/for/amlogic-3.14-dev (not Signed-off-by author/committer/uploader in commit message footer)

关掉多实例
setprop media.omx.single_mode 1 

2.
1）音频的播放的原因是csd数据，softmp3不解析csd数据，找不到同步字，就导致失败；
2）视频不能播放的原因是，pts一直是0
3）修改后，单独的音频或视频是可以播放的，音频的pts正常，视频的pts一直为0；

3.
1) AVC-xxtruehd.7.1x264-publichd.mkv    video/mp4  nuplayer 出现卡顿
Metadata:
    encoder         : libebml v1.3.0 + libmatroska v1.4.1
    creation_time   : 2013-10-15 03:04:42
  Duration: 00:00:49.38, start: 0.000000, bitrate: 15673 kb/s
    Stream #0:0(eng): Video: h264 (High), yuv420p, 1920x800 [SAR 1:1 DAR 12:5], 23.98 fps, 23.98 tbr, 1k tbn, 47.95 tbc (default)
    Stream #0:1(eng): Audio: truehd, 48000 Hz, 7.1, s32 (24 bit) (default)
    Stream #0:2(eng): Subtitle: subrip
	
2) avc_xxxTitle800, libplayer  不支持
Metadata:
    title           : TRANSFORMERS_3_AC.Title800.BlurayRip
    encoder         : libebml v0.7.8 + libmatroska v0.8.1
    creation_time   : 2013-05-21 11:33:47
  Duration: 00:04:41.39, start: 0.000000, bitrate: 30983 kb/s
    Chapter #0:0: start 3113.026000, end 281.386656
    Metadata:
      title           : (01)00:51:53:026
    Stream #0:0: Video: h264 (High), yuv420p, 1920x1080 [SAR 1:1 DAR 16:9], 23.98 fps, 23.98 tbr, 48003.07 tbn, 47.95 tbc (default)
    Stream #0:1(eng): Audio: truehd, 48000 Hz, 7.1, s32 (24 bit) (default)
	
3) avc_ID_Title216， libplayer  不支持
Metadata:
    title           : VOLUME_ID.Title216.Angle1.BlurayRip
    encoder         : libebml v0.7.8 + libmatroska v0.8.1
    creation_time   : 2013-05-21 08:36:29
  Duration: 00:05:32.08, start: 0.000000, bitrate: 21487 kb/s
    Chapter #0:0: start 5398.684000, end 332.081745
    Metadata:
      title           : (01)01:29:58:684
    Chapter #0:1: start 5537.323000, end 332.081745
    Metadata:
      title           : (02)01:32:17:323
    Stream #0:0: Video: h264 (High), yuv420p, 1920x1080 [SAR 1:1 DAR 16:9], 23.98 fps, 23.98 tbr, 48003.07 tbn, 47.95 tbc (default)
    Stream #0:1(English): Audio: truehd, 48000 Hz, 5.1(side), s32 (24 bit) (default)
    Stream #0:2: Subtitle: dvd_subtitle, 1920x1080 (default)
    Stream #0:3: Subtitle: dvd_subtitle, 1920x1080
    Stream #0:4: Subtitle: dvd_subtitle, 1920x1080
	

2017/05/27 9:15-18:30
1.yuguanyin, 视频可以放，音频不可以，可能是音频的采样率不对。=>采用adts软解

2.AVC-[1920 X 800][15.7 Mbps&23.976 fps][TrueHD-8ch]g.i.joe.retaliation.2013.EXTENDED.1080p.bluray.truehd.7.1.x264-publichd.mkv
使用ffplay打印，libplayer卡顿时出现如下：
[h264 @ 000000000348eb00] cabac decode of qscale diff failed at 11 10
[h264 @ 000000000348eb00] error while decoding MB 11 10, bytestream 117529
[h264 @ 000000000348eb00] concealing 4838 DC, 4838 AC, 4838 MV errors in B frame

3.AVC-[1920 X 1080][31.0 Mbps&23.976 fps][TrueHD-8ch]TRANSFORMERS_3_AC.Title800.mkv
使用ffplay打印，libplayer卡顿时出现如下：
[h264 @ 00000000035f6580] left block unavailable for requested intra4x4 mode -1
[h264 @ 00000000035f6580] error while decoding MB 0 29, bytestream 19382
[h264 @ 00000000035f6580] concealing 649 DC, 649 AC, 649 MV errors in P frame


2017/05/31 10:12-21:10
1.关掉音频后，视频卡的时间变短了
setprop media.amplayer.noaudio true
echo 0> /sys/class/tsync/enable
发现卡住的时候，视频的pts不变，音频的pts在变

echo 7 > /proc/sys/kernel/printk
echo 1 > /sys/class/tsync/debug_audio_pts
echo 1 > /sys/class/tsync/debug_video_pts
echo 1 > /sys/class/tsync/debug_pts_checkin
echo 1 > /sys/class/tsync/debug_pts_checkout
2.

今天新分配：
/////////144381 : s905_p212  {AV} Nuplayer播放VP6/VP8视频，声音输出正常，但audio menu显示unknow 概率：100％ 对比：libplayer正常 
144839 ----转给wangxiaoliang
s905_p212-
使用libplayer播放会卡死
 {AV} Amnuplayer播放多video track视频，切换video track后，选择唯一的audio track，音轨会改变 概率：100％ 对比：关闭nuplayer后正常 (edit) 

143674 :{AV} Amnuplayer播放huanzhugege.ts，通过INFO BAR"<<"">>" ICON进行快进退后，系统提示”movieplayer isn't responding” 概率:100% 对比: Amnuplayer关闭后正常, P212 7.1.1正常
143180 :{AV} trunk20170410开始播放DVD ISO中的vob视频，画面跳帧 概率：100% 对比：trunk0408正常
王健转
145130  {AV-煲机}煲机全格式播放24H+,画面黑屏，播放器卡住，遥控器操作几下提示“movieplayer isn't responding”
HEVC-AACLC-1855Kbps-1920x1080.ts
set eos to decoder
kWhatReset

138796

p2---转给zhanghui
145272 {AV}:movieplayer中播放true-hd视频文件，画面卡顿。概率：100%，对比：T962E 7.1同样有此问题，S905X 7.1无此问题


2017/06/01 9:12-21:10
1.145130
初步分析是omx解码没有退出
66% 2712/vdec-core: 0% user + 66% kernel
AmlogicVideoDecoderAwesome( 4026): ~AmlogicVideoDecoderAwesome


2017/06/02 9:14-18:30

2017/06/05 8:58-18:10
1.

2017/06/05 9:10-18:10
145130-
1.NU-NuPlayerDecoder( 4025): [doFlush:417] video flushing 这个不成功


2.138796
这个log不全，感觉卡住的地方，libplayer与nuplayer混在一块了

3.143180
http://scgit.amlogic.com:8080/#/q/status:merged,1525

同步卡顿
查看同步模式，关闭同步，或者关闭声音
cat /sys/class/tsync/mode
echo 0 > /sys/class/tsync/enable
setprop media.amplayer.noaudio true
查看checkin checkout pts
echo 7 > /proc/sys/kernel/printk
echo 1 > /sys/class/tsync/debug_audio_pts
echo 1 > /sys/class/tsync/debug_video_pts
echo 1 > /sys/class/tsync/debug_pts_checkin
echo 1 > /sys/class/tsync/debug_pts_checkout




后处理相关卡
关闭DI
echo 1 > /sys/module/di/parameters/bypass_all
或
echo rm default > /sys/class/vfm/map
echo add default decoder ppmgr amvideo > /sys/class/vfm/map

关闭ppmgr
echo rm default > /sys/class/vfm/map
echo add default decoder deinterlace amvideo > /sys/class/vfm/map

通过underflow查看
cat /sys/module/amvideo/parameters/underflow
cat /sys/class/video/freerun_mode
卡顿时时看这个值否一直增加，若是则是amvideo前边的节点送数据慢导致

带宽不足
提高cpu频率
cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq
echo performace > scaling_governor
关闭osd
echo 1 > /sys/class/graphics/fd0/blank

3.Bug 145397 - {Stress Test}{AV}AV 全格式视频煲机，煲机12小时退回到文件列表菜单并进入屏保

2017/06/07 8:58-18:50
1.nuplayer 添加flv格式的支持

2.143180 :{AV} trunk20170410开始播放DVD ISO中的vob视频，画面跳帧 概率：100% 对比：trunk0408正常
0408视频看着也是卡的

3.-------------
Bug 144386 - {AV} Trunk autobuild20170511开始，播放同时有DTS/Dolby音轨的TS视频，从Dolby切换到DTS音轨后画面花屏 
http://scgit.amlogic.com:8080/#/q/status:merged,750   
V NU-NuPlayerRenderer: video late by 1468057 us (1.47 secs)

2017/06/08 8:55-18:50

1.nuplayer添加nuplayer
2.huanzhugege问题是由于计算时长引起的，libplayer计算时长是有问题的

2017/06/06 8:53-18:50
1.煲机出现文件列表
test/h.263-AAC-LC-482 Kbps-704x576.3g2
set_player_state(player, PLAYER_INITING);
update_playing_info(player);
update_player_states(player, 1);

enter into player_thread
可能是libplayer没有正常退出，引起的 not
MediaPlayerService 
MEDIA_SET_VIDEO_SIZE

//waite until libplayer prepare 
	while(!Prepared){
		if(mEXIT || mPrepareErr)
			break;
		usleep(1000);
	}

2. 煲机问题，退出播放界面
Bug 145397 - {Stress Test}{AV}AV 全格式视频煲机，煲机12小时退回到文件列表菜单并进入屏保

2017/06/12 9:17-21:10
1. 143180 :{AV} trunk20170410开始播放DVD ISO中的vob视频，画面跳帧 概率：100% 对比：trunk0408正常

video checkin pts
Ptsserv.c
check in vpts <0x%x:0x%x>,
current vpts 0x%x

checkout pts
vpts look up offset<0x%x> -->
<0x%x:0x%x>, look_cnt = %d

cat boot.img > /dev/block/boot

2.
[Bug 145705] {AV} Trunk autobuild20170607开始，播放只有一个音轨的TP视频，audio track多显示一个"MP3"音轨，选择按OK提示unsupport media 概率：100％ 对比：trunk0606正常


2017/06/13 9:25-20:30
echo 7 > /proc/sys/kernel/printk
cat boot.img > /dev/block/boot
setprop libplayer.ps.softdemux 1
7号的不卡
http://scgit.amlogic.com:8080/#/q/status:merged,1800

2017/06/14 9:10-20:50
1.十六进制转换化十进制
a=ff
$ ((b=16#$a))
$ echo $b
255

2.恢复确认问题
确认是之前的一个patch引起的

3.Bug 145792 - {AV}:煲机4KH264&4KH265文件混播 39H，平台退回主界面，并进入屏保。概率：1/1，对比：煲机问题，无需对比
/storage/04B8E485B8E47698/4kh265&4kh264/[4KH265_50.000fps_10bit]ShutUpAndPlay.Berlin.2014.2160p.HDTV.HEVC-jTV_50fps_10bit.ts
/storage/04B8E485B8E47698/4kh265&4kh264/[4KH265_50.000fps_10bit]ShutUpAndPlay.Berlin.2014.2160p.HDTV.HEVC-jTV_50fps_10bit.ts
/storage/04B8E485B8E47698/4kh265&4kh264/[4KVP9_23.976fps_26.5Mbps_10bit]4K_HDR_Ss75O8yllyc_VP9profile2_itag337.webm
/storage/04B8E485B8E47698/4kh265&4kh264/[4KVP9_60fps_30.3Mbps_8bit]uhd3d-Sony_Aquarium.webm
/storage/04B8E485B8E47698/4kh265&4kh264/4K American Cities4096x2304-47mb.mp4
/storage/04B8E485B8E47698/4kh265&4kh264/[4KH265_50.000fps_10bit]ShutUpAndPlay.Berlin.2014.2160p.HDTV.HEVC-jTV_50fps_10bit.ts
/storage/0485B8E47698/4kh265&4kh264/[4KVP9_23.976fps_26.5Mbps_10bit]4K_HDR_Ss75O8yllyc_VP9profile2_itag337.webm
/storage/04B8E485B8E47698/4kh265&4kh264/[4KVP9_60fps_30.3Mbps_8bit]uhd3d-Sony_Aquarium.webm
/storage/04B8E485B8E47698/4kh265&4kh264/4K American Cities4096x2304-47mb.mp4

20:30 开机煲机

2017/06/15 9:20-20:00
1. echo m > /proc/sysrq-trigger
/proc/vmallocinfo
/proc/pagetypeinfo
/proc/buddyinfo可以看到buddy系统总得内存分配状态， 及更多关于碎片管理的信息

2.Bug 145974 - {AV}平台Amnuplayer播放器问题，在MoviePlayer播放任意4K视频，设置Display Mode为4:3时，画面还是16:9显示，只是缩小了

cat /sys/class/video/axis
cat /sys/class/video/screen_mode

20:00煲机-10:20

2017/06/16 9:30-
1.boot更新kernel
uboot下：
usb start;
usb_update boot boot.img;
save
reset


2.[Bug 146041] {AV} Amnuplayer 播放部分mkv视频，seek后画面卡顿，音画不同步

3.20:50 baoji

2017/06/19 9:30-21:10
1.
cat /sys/class/video/axis
cat /sys/class/video/screen_mode
dumpsys SurfaceFlinger
logcat -s amavutils

2.
aarch64-linux-gnu-addr2line -f -e vmlinux  0xffffffc0010dda80


3.
Bug 145966 - {HDR}Amnuplayer播放器问题，在MoviePlayer播放个别HLG片源TravelXP_4K_HDR_HLG.ts，播放到00:08的时候提示不支持。100%复现，关闭Amnuplayer可播放完

21:05煲机

2017/06/20 9:30-20:00

1.
setprop media.hls.ptsdebug 4


2017/06/21 9:00-20:05
1.seek的问题是由于flush后，音频多了最后一帧

2.
setprop media.omx.audio.debug 1
tftp -r wangcfg_board.rc -g 10.68.8.200
setprop media.amplayer.nosubtitle 1

23记录的是liscence的
31 fei liscence
41 xujian 编译的


3.Bug 141331 - {AV} Autobuild20170321开始用Amnuplayer，不同分辨率（画面比例）的视频，在正常播放切换到下一个视频时，画面会有拉伸或收缩的效果 概率：100％ 对比：2017-03-20没有用Nuplayer


cp libstagefright_soft_dtshd.so_xujian /system/lib/libstagefright_soft_dtshd.so

4.Bug 145438 - {AV-煲机}4KH265 Random seek 72H+，视频画面卡住，Seek操作停止。2/2，对比：不需要


2017/06/22 9:30-
1.
Bug 141326 - {AV} Autobuild20170321开始用Amnuplayer，播放1920x1088分辨率的视频，画面最下方有一条灰色粗线 概率：100％ 对比：2017-03-20没有用Nuplayer 
echo "0 10 1918 1088" >  /sys/class/video/axis
echo 1 > /sys/class/video/screen_mode

setprop media.amnuplayer.localplay true
setprop media.amnuplayer.localplay false

2. libplayer
cat /sys/class/video/screen_mode
1:full stretch
cat /sys/class/video/axis
0 0 1918 1079
dumpsys SurfaceFlinger
           HWC |   7a6fa13dc0 |      21010 | 00 | 1.00 | 00 | 0000 |    0.0,    0.0,   32.0,   32.0 |    0,    0, 1919, 1080 
          GLES |   7a6fa14040 |      21015 | 00 | 1.00 | 00 | 0002 |    0.0,    0.0, 1920.0, 1080.0 |    0,    0, 1920, 1080 
          GLES |   7a6fa135a0 |     201000 | 00 | 1.00 | 00 | 0002 |    0.0,    0.0, 1920.0, 1080.0 |    0,    0, 1920, 1080

3. nuplayer
1) displayer 1
video显示正常
setprop media.omx.display_mode 1
cat /sys/class/video/axis
7 0 1911 1079
 Layers state:
    numLayers=3
       type    |    handle    |   zorder   | ds | alpa | tr | blnd |     source crop (l,t,r,b)      |          frame         
  -------------+--------------+------------+----+------+----+------+--------------------------------+------------------------
          GLES |   7def4144a0 |      21015 | 00 | 1.00 | 00 | 0002 |    0.0,    0.0, 1920.0, 1080.0 |    0,    0, 1920, 1080 
          GLES |   7def414720 |     201000 | 00 | 1.00 | 00 | 0002 |    0.0,    0.0, 1920.0, 1080.0 |    0,    0, 1920, 1080 
           HWC |   7defa46060 |      21010 | 00 | 1.00 | 00 | 0000 |    0.0,    0.0, 1920.0, 1088.0 |    7,    0, 1912, 1080

		   
2) displayer 0
cat /sys/class/video/screen_mode
0:normal
 cat /sys/class/video/axis
0 0 -1 -1

  Layers state:
    numLayers=3
       type    |    handle    |   zorder   | ds | alpa | tr | blnd |     source crop (l,t,r,b)      |          frame         
  -------------+--------------+------------+----+------+----+------+--------------------------------+------------------------
          GLES |   7a6fa13dc0 |      21010 | 00 | 1.00 | 00 | 0000 |    0.0,    0.0, 1920.0, 1088.0 |    7,    0, 1912, 1080 
          GLES |   7a6fa13fa0 |      21015 | 00 | 1.00 | 00 | 0002 |    0.0,    0.0, 1920.0, 1080.0 |    0,    0, 1920, 1080 
          GLES |   7a6fe46060 |     201000 | 00 | 1.00 | 00 | 0002 |    0.0,    0.0, 1920.0, 1080.0 |    0,    0, 1920, 1080 
		  
自己设置试试不行
ffmpeg interlaced Progressive

4.
echo rm default > /sys/class/vfm/map
echo add default decoder  amvideo > /sys/class/vfm/map

amsysfs_set_sysfs_str("/sys/class/vfm/map", "rm default");
amsysfs_set_sysfs_str("/sys/class/vfm/map", "add default decoder amlvideo deinterlace amvideo");
	

20170623 9:30-21:10
1.
echo '12af' | awk '{print strtonum("0x"$0)}'  十六进制转十进制
echo '011257' | awk '{print strtonum($0)}'   十进制转十六进制
echo "4783"|awk '{printf("%o\n",$0)}' 八进制转十进制:


20170626 14:00-19:00
1.
[250752.060832@0] codec:<0x972138:0x264eab>, look_cnt = 1
[250752.089825@0] codec:<0x9779ee:0xf5c283a1>, look_cnt = 2
[250752.123731@0] codec:<0x97bc14:0xbba>, look_cnt = 3
[250752.153729@0] codec:<0x97c568:0x1775>, look_cnt = 2
[250752.219675@0] codec:<0x97b4ae:0xf5c283a1>, look_cnt = 1
[250752.253731@0] codec:<0x97d600:0x2eeb>, look_cnt = 3
[250752.283727@0] codec:<0x97e07e:0x3aa6>, look_cnt = 2


20170627 9:32-20:10
1.
VTS02.vob interlaced

omx提交添加commitid的方法
gitdir=$(git rev-parse --git-dir); scp -p -P 29418 shuanglong.wang@scgit.amlogic.com:hooks/commit-msg ${gitdir}/hooks/
git commit --amend


20170628 9:25-20:45
1.145130
displayThread___eos_fillBufferDone

以下未打印
:13:03.058 I/OmxComponent( 4084): OMX.amlogic.avc.decoder.awesome: flush output
129791 01-01 01:13:03.058 V/OMX_WorkerPeer( 4084): hardware/amlogic/omx/omx_framework/WorkerPeer.cpp:runWorker:158 -----
       ---------------
129792 01-01 01:13:03.058 V/AmlogicVideoDecoderAwesome( 4084): flushOutput:671 >
129793 01-01 01:13:03.058 D/AmlogicVideoDecoderAwesome( 4084): displayThread__flushOutput__fillBufferDone
129794 01-01 01:13:03.058 D/AmlogicVideoDecoderAwesome( 4084): displayThread__flushOutput__fillBufferDone
129795 01-01 01:13:03.063 I/NU-NuPlayerDecoder( 4089): [doFlush:421] video flushing


2.
cat /sys/class/tsync/pts_video && cat /sys/class/tsync/pts_pcrscr

3.
小米卡的原因是video的pts没有设置上
echo 1 > /sys/class/video/slowsync_repeat_enable
echo 0 > /sys/class/video/slowsync_repeat_enable

4.
Bug 146517
{AV} [瑞致达反馈146575]Trunk autobuild20170522开始出现，Amnuplayer下播放23.976/29.97/59.94fps的4K H265视频，开头2秒会有轻微的卡顿 概率：100％ 对比：trunk0521正常
http://scgit.amlogic.com:8080/#/c/21843/

5.
debuggerd $(busybox pidof mediaserver)
debuggerd $(busybox pidof surfaceflinger)

kill -3 $(busybox pidof mediaserver)

20170629 9:24-21:10
1.
tftp -r wang.rc -g 10.68.8.39

echo "codec:<0x81d3e:0x18250>, look_cnt = 1" | sed 's/.*0x\(.*\)>,.*/\1/'|awk '{print strtonum("0x"$0)}

sed -n 's/.*0x\(.*\)>,.*/\1/p' 20170629_hbovpts.log >a.log
awk '{print strtonum("0x"$0)}' a.log > b.log

sed -n 's/.*<\(.*\)>.*/\1/p'| sed -n 's/.*:0x\(.*\)/\1/p'

 sed -n 's/.*<\(.*\)>, look_cnt.*/\1/p' 20170629_hbovpts.log
 
 
20170630 9:20-19:50
1.
git log --committer="Stark Li <stark.li@amlogic.com>"

2.
cat /sys/module/amvdec_mh264/parameters/decode_timeout_val
echo 400 > /sys/module/amvdec_mh264/parameters/decode_timeout_val


cat /sys/module/amvdec_h265/parameters/decode_timeout_val
echo 400 > /sys/module/amvdec_h265/parameters/decode_timeout_val
echo 1000 > /sys/module/amvdec_h265/parameters/decode_timeout_val
echo 0 > /sys/module/amvdec_h265/parameters/decode_timeout_val



20170703 9:23-20:25
1.
Prepared = false;

current_type = newtype;

while(!(Prepared && (current_type != AMSUPER_PLAYER)))


20170704 9:55-20:30
1.Bug 140482 - {Dolby Vision}在Settings内设置DV Set为Follow Source后，播放部分DV测试文件，无法识别为DV源。100%复现，对比LG电视可识别。
两路video es根据相同的pts合到一路video es，送给解码器
00 00 00 01 7c 01 19

2.Bug 144928 - [P32A0-Video]：播放部分H264/H265片源，如011121200.MTS（1080p h264），seek时高概率性出现画面左右抖动。概率：80% 

3.Bug 144451 - {AV} Amnuplayer播放HBO-5-9-17-1123EST (1).ts，画面很卡 概率:100% 对比:libplayer正常
应该是checkin的pts送的有问题，发现已接近demux后pts的预测转换有点问题
static int unPTSReliableCnt = 0;

20170705 9:25-17:35
1. pts计算有问题，已修改

2. dolbyvision
保存omx接收的es流
setprop media.omx.dumpRecv true
setprop media.omx.RecvName true

setprop media.omx.dv_open 1

3.
8cec0762335add74a9c49d8919d31f7127719033
 modified:   AmFFmpegAdapter/extractor/AmFFmpegExtractor.cpp
        modified:   AmFFmpegAdapter/formatters/AVCCFormatter.cpp
        modified:   AmFFmpegAdapter/formatters/AVCTSFormatter.cpp
        modified:   AmFFmpegAdapter/formatters/HVCCFormatter.cpp
        modified:   AmFFmpegAdapter/formatters/PassthruFormatter.cpp
        modified:   AmFFmpegAdapter/formatters/StreamFormatter.h
        modified:   media/Am-NuPlayer/AmGenericSource.cpp
        modified:   media/Am-NuPlayer/AmGenericSource.h

20170706 9:36- 18:50
1.
31,32,是mov的seek的log

( (mState >= STATE_PREPARED) && (mState != STATE_PLAY_COMPLETED) && (mState <= STATE_SEARCHING))
FFimpl

2.
07-06 08:34:07.767  9091  9306 D AmlogicVideoDecoderAwesome: mInputQueue.empty Video
07-06 08:34:07.768  9091  9306 V AmlogicVideoDecoderAwesome: doCodecSpec csd_len=4147
07-06 08:34:07.768  9091  9306 E AmlogicVideoDecoderAwesome: SPS: Main10 profile bitstream
07-06 08:34:07.768  9091  9306 E AmlogicVideoDecoderAwesome: SPS: bit_depth=10,10
07-06 08:34:07.768  9091  9306 E AmlogicVideoDecoderAwesome: SPS: Main10 profile bitstream
07-06 08:34:07.768  9091  9306 E AmlogicVideoDecoderAwesome: SPS: bit_depth=10,10
07-06 08:34:07.768  9091  9306 V AmlogicVideoDecoderAwesome: hevc csd size = 210, [1920:1080],bitdepth=10
07-06 08:34:07.771  9091  9306 D AmlogicVideoDecoderAwesome: =11, =3840, =2160, =0, =0, =0, =333666, =166833, =4147, =28791, =13333

07-06 08:35:26.974  9091  9824 D AmlogicVideoDecoderAwesome: mInputQueue.empty Video
07-06 08:35:26.975  9091  9824 V AmlogicVideoDecoderAwesome: doCodecSpec csd_len=4147
07-06 08:35:26.975  9091  9824 E AmlogicVideoDecoderAwesome: SPS: Main10 profile bitstream
07-06 08:35:26.975  9091  9824 E AmlogicVideoDecoderAwesome: SPS: bit_depth=10,10
07-06 08:35:26.975  9091  9824 E AmlogicVideoDecoderAwesome: SPS: Main10 profile bitstream
07-06 08:35:26.975  9091  9824 E AmlogicVideoDecoderAwesome: SPS: bit_depth=10,10
07-06 08:35:26.975  9091  9824 V AmlogicVideoDecoderAwesome: hevc csd size = 210, [1920:1080],bitdepth=10
07-06 08:35:26.975  9091  9824 D AmlogicVideoDecoderAwesome: check if is dves
07-06 08:35:26.975  9091  9824 I AmlogicVideoDecoderAwesome: es is dves, need use dv decoder
07-06 08:35:27.215  9091  9824 V AmlogicVideoDecoderAwesome: csdsize=210


07-06 08:57:57.554  4083  5613 D AmlogicVideoDecoderAwesome: mInputQueue.empty Video
07-06 08:57:57.555  4083  5613 V AmlogicVideoDecoderAwesome: doCodecSpec csd_len=2269
07-06 08:57:57.555  4083  5613 E AmlogicVideoDecoderAwesome: SPS: Main10 profile bitstream
07-06 08:57:57.555  4083  5613 E AmlogicVideoDecoderAwesome: SPS: bit_depth=10,10
07-06 08:57:57.555  4083  5613 V AmlogicVideoDecoderAwesome: hevc csd size = 105, [3840:2160],bitdepth=10
07-06 08:57:57.557  4083  5613 D AmlogicVideoDecoderAwesome: =11, =3840, =2160, =0, =0, =0, =333666, =166833, =2269, =26621, =12258

20170707 9:25-19:50
1.


20170710 9:35-20:05
1.http://scgit.amlogic.com:8080/#/c/26365/
这个需要提交 

2.
vp9 malloc size=37592


3.Bug 146816 - [IQIYI-S905X-6.0-AV]:爱奇艺版本306068上用android手机在推送iqiyi,youku片源时会有音视频不同步情况--高概率
setprop media.hls.ptsdebug 4
setprop media.omx.log_levels 255

4.Bug 146229 - [P32A0-Video]：本地播放VTS_02_1.VOB大摆锤画面严重卡顿不流畅

20170711 9:45-
1.
145130
109
position : 46579 msec，阻塞在这了，下面的信息一直没有打印出来
E/NU-GenericSource( 4086): hasBufferAvailable return -1011
  16653 01-01 00:16:56.589 D/AmlogicVideoDecoderAwesome( 4083): mInputTimeStampChanged = true,mLastInputTimeStamp=91966,bufferHdr.nTimeStamp=0
  16654 01-01 00:16:56.589 I/amcodec ( 4083): codec_set_eos is_eos =1
  
  
2. 145130
HEVC-HEAAC-196Kbps-256x144.mp4

0627_198
H.263-AAC-LC-182 Kbps-176x144.3GP.3GP

0627_199
H.263-AMR-132 Kbps-176x144.mp4


20170712 9:45-20:40
1.
----Bug 144154 - {AV}平台Amnuplayer播放器问题，播放个别视频文件画面黑屏无法播放。100%复现，对比Amnuplayer为False可播放
Bug 145965 - {AV} S905X-Multi-dec，add 6路 480p 30fps h264/h265/vp9，任意组合播放，6路画面都很卡，有时其中几路画面会卡住不动 概率：100％ 对比：新功能无需对比 [这个是u盘和移动硬盘速度问题,可以优化,不一定能解决]
----Bug 145969 - {AV} S905X-Multi-dec，6路480P 30FPS H265，播放时第5、6路视频不显示 概率：100％ 对比：H264/VP9正常   [omx限制了265的个数,可以修改]
Bug 145972 - {AV} S905X-Multi-dec, add一路1080P 30fps h264视频，一路4K 30FPS H264,播放中，4K 30FPS H264卡顿 
Bug 145130 - {AV-煲机}煲机全格式播放24H+,画面黑屏，播放器卡住，遥控器操作几下提示“movieplayer isn't responding”。2/2，对比：不需要
----Bug 141970 - [P355-客户反馈#3116-Video]：本地播放1080P30帧的片源HiVi+Cast-00069.m2ts卡顿不流畅，有严重丢帧，100%，T968、T966系列平台均存在 (edit) 
Bug 146229 - [P32A0-Video]：本地播放VTS_02_1.VOB大摆锤画面严重卡顿不流畅，100%
-----Bug 146816 - [IQIYI-S905X-6.0-AV]:爱奇艺版本306068上用android手机在推送iqiyi,youku片源时会有音视频不同步情况--高概率
Bug 140482 - {Dolby Vision}在Settings内设置DV Set为Follow Source后，播放部分DV测试文件，无法识别为DV源。100%复现，对比LG电视可识别


2.
setprop media.omx.dumpCodec true  接收到的数据
setprop media.omx.dumpRecv true 向codec送数据
setprop media.dv.dumpEs true
setprop media.omx.dv_open 1
setenforce 0
chmod 777 /data/tmp/
ves_splitter -ves es_aml_recv.265 -bl bl.es -blc 1 -el el.es -elc 1 -rpu tmp.rpu -reorder 1


20170713 9:05-20:44
1.
mNativeWindow->dequeueBuffer <- dequeueBufferFromNativeWindow <- waitUntilAllPossibleNativeWindowBuffersAreReturnedToUs <- changeStateIfWeOwnAllBuffers  
<-  ACodec::FlushingState::onOMXEvent OMX_EventCmdComplete <- 

2.dolby vision page35

3.
01 46 01 10 00 00 00 01 40 01 0C 01 FF FF 02 A0 00 00 03 00 B0 00 00 03
  
20170714 9:38-16:55
1.
199
/storage/2C83-0E8C/video/RealVideo1_ac3_929kbps_1280x720.rm,  rm,rmsoft, 走了NuPlayer，不是AmNuPlayer

195
/storage/AE22-5E15/video/S-Mpeg4 v3-WMA2-150 Kbps-320x240.wmv,  asf, 

Successfully allocated codec 'OMX.google.wma.decoder'

1655394 01-01 06:56:12.340 I/amplayer(18711): [non_raw_read:1179]av_read_frame return (-541478725)
1655395 01-01 06:56:12.340 I/amplayer(18711): [non_raw_read:1179]av_read_frame return (-541478725)
1655396 01-01 06:56:12.341 I/amffmpeg(18711): [ff_asf_parse_packet] feof
1655397 01-01 06:56:12.341 I/amplayer(18711): [non_raw_read:1179]av_read_frame return (-541478725)
1655398 01-01 06:56:12.341 I/amffmpeg(18711): [ff_asf_parse_packet] feof
1655399 01-01 06:56:12.341 I/amplayer(18711): [non_raw_read:1179]av_read_frame return (-541478725)
1655400 01-01 06:56:12.341 I/amplayer(18711): non_raw_read: read end!
1655401 01-01 06:56:12.341 I/amcodec (18711): codec_set_eos is_eos =1

20170717 9:40-22:05

1.
Affected Repositories:
  http://scgit.amlogic.com:8080/26862

Fix Summary:
  PD#145969: modify avc,hevc,vp9 max instance

Reviewer(s) Requested:
   zhi.zhou@amlogic.com
   
Testing Suggestion:
	1.merge the difference
	2.compile libOmxVideo.so in path "ardware/amlogic/omx/ComponentPeers/libOmxVideo"
	3.replace compiled libOmxVideo.so in board and restart. compile so have upload ftp dirctory "/private_build/145969"
	
2.

commit 7b9c515e4d0676d7bc4ef2c2ec3bc2a915a778c2
Author: shuanglong.wang <shuanglong.wang@amlogic.com>
Date:   Mon Jul 17 18:44:07 2017 +0800

    PD#145969: modify avc,hevc,vp9 max instance
    
    Change-Id: Ifb322522c872f5c0eed17397214b0f1f7ef2e8d9
	
20170718 9:30-20:45
1.
/* if (pdata[0]==0x00 && pdata[1]==0x00 && pdata[2]==0x00 && pdata[3]==0x01) {
                memcpy(ab->data() + mb->range_length(),
                    dolbyvision_eheader_4,
                    6);
                memcpy(ab->data() + mb->range_length() + 6,
                    (const uint8_t *)second->data()  + second->range_offset() + 4,
                    second->range_length() - 4);
             } else if (pdata[0]==0x00 && pdata[1]==0x00 && pdata[2]==0x01) {
                memcpy(ab->data() + mb->range_length(), 
                    dolbyvision_eheader_3,
                    5);
                memcpy(ab->data() + mb->range_length() + 5,
                    (const uint8_t *)second->data()  + second->range_offset() + 3,
                    second->range_length() - 3);
             } else {
                ALOGE("[%s:%d] this should not enter!\debug_dolbyn",__func__,__LINE__);
             }*/
			 
2.
dolby vision debug信息,droid setting
echo 3 > /sys/module/am_vecm/parameters/debug_dolby
cat /sys/module/am_vecm/parameters/dolby_vision_enable
echo 1 > /sys/module/am_vecm/parameters/dolby_vision_enable

echo 1 > /sys/module/amvdec_h265/parameters/debug
echo 3 > /sys/module/am_vecm/parameters/debug_dolby
cat /sys/class/amvecm/dv_mode
3.
cat /sys/class/video/frame_rate

4.
Affected Repositories:
  http://scgit.amlogic.com:8080/26445
  http://scgit.amlogic.com:8080/26421

Fix Summary:
  PD#140482: nuplayer add Dolby Vision support

Reviewer(s) Requested:
   zhi.zhou@amlogic.com
   
Testing Suggestion:
	1.merge the difference
	2.compile  libamffmpegadapter.so in path "vendor/amlogic/frameworks/av/AmFFmpegAdapter"
	3.compile  libamnuplayer.so in path "vendor/amlogic/frameworks/av/media/Am-NuPlayer"
	4.replace compiled libamffmpegadapter.so and libamnuplayer.so in board and restart. compile so have upload ftp dirctory "/private_build/140482/r311"


20170720 9:20-20:20
1.
cat /sys/class/vfm/map
cat /sys/class/amstream/bufs
echo dump decoder > /sys/class/vfm/map
echo dump ppmgr > /sys/class/vfm/map
echo dump amlvideo > /sys/class/vfm/map
echo dump vdin0 > /sys/class/vfm/map

20170721 9:30-20:20
1.

20170723 9:37(40)-14:40 0.5
1. 1080p和4k，omx显示写数据慢，低于framerate

20170724 9:31-20:40
1. 219 卡在getduration
/storage/AE22-5E15/video/VP9-Vorbis-6912Kbps-3840x2160.webm

2.
echo -3800 > /sys/module/amvideo/parameters/omx_pts_interval_lower
echo 2000 > /sys/module/amvideo/parameters/omx_pts_interval_upper

echo -5500 > /sys/module/amvideo/parameters/omx_pts_interval_lower

echo 11000 > /sys/module/amvideo/parameters/omx_pts_interval_upper


3.
setprop ro.media.maxmem 419430400    //450M


2017_Prime_4K_NY_L_H__LG logo_0405.ts
[ 4974.930950@0] [0]set pic_list_init_flag 1
[ 4974.932142@2] [0]init_buf_spec2 3840 2160
[ 4974.932145@2] [0]set pic_list_init_flag to 2
[ 4974.943204@0] [0]set pic_list_init_flag to 3
[ 4974.974966@0] 
[ 4974.974966@0] [amvideo..] saturation_pre:32 hue_pre:0 mab:1400000
[ 4974.977146@0] codec:Try DW buffer for compressed frame scaling.
[ 4975.166678@0] tx queueing
[ 4979.992861@1] [0]cur lcu idx = 1, (total 2040), set error_mark
[ 4980.047553@0] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4980.077309@0] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4980.078143@3] [0]cur lcu idx = 0, (total 2040), set error_mark


2017 9:34-21:05
1./storage/A67EDA9A7EDA629B/dobly version/[SUHD]Journey_of_Color.ts
/storage/5439-DB47/dobly version/PS3é«<98>æ¸<85>ç<94>µå½±è<9d><99>è<9d> ä¾ å<89><8d>ä¼
         é»<91>å¤<9c>ä¹<8b>ç¥<9e>1080PH264.MP4 [1920 X 1080P] [5716Kbps & 23.976fps].mp4
/storage/2C83-0E8C/video/H.263-AMR-132 Kbps-176x144.mp4
/storage/B82A-D801/video/h.263-AAC-LC-482 Kbps-704x576.3g2
/storage/2C83-0E8C/video/H.263-AMR-132 Kbps-176x144.mp4

cat /sys/class/vfm/map

2.
echo -1000 > /sys/module/amvideo/parameters/omx_pts_interval_lower

20180726 9:37-20:40
1.
modified:   ../include/media/stagefright/ACodec.h
        modified:   libstagefright/ACodec.cpp
		
		
1.VTS_02_1.VOB
1）正常情况下，checkin的pts是乱序的（但差值是有规律的），checkout的pts是顺序的（差值相同）；
2）checkin的pts的差值有问题，应该是乱序的，checkin的pts不正常为会导致checkout的pts异常（不是顺序的，差值不相同）；
3）这个流应该有nopts的包，看小米checkin的pts，有可能是采用dts替代pts，这样会引起视频的卡顿；

2.HiVi+Cast-00069.m2ts
1）正常情况下，checkin的pts是乱序的（但差值是有规律的），checkout的pts是顺序的（差值相同）
2）这个视频的使用ffmpeg demux出来的pts是正常的，pts的差值也是有规律的（这个流的应该没有nopts的包）
3）小米demux出来的pts有的异常，异常可以从pts的差值有部分异常，以及出现pts为0；


3.
[4KH265_61.6Mbps60.000fps_29.7Mbps_8bit]UMAX_HEVC_4K_60fps_16bits.ts 
[ 4631.998750@2] [0]cur lcu idx = 521, (total 2040), set error_mark
[ 4632.000225@0] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.006281@0] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.011597@2] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.017283@0] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.025697@0] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.028895@0] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.034722@2] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.040333@2] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.046589@2] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.051717@2] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.057597@2] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.063366@2] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.069065@2] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.074899@2] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.080560@0] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.086442@2] [0]cur lcu idx = 0, (total 2040), set error_mark
[ 4632.092282@0] [0]cur lcu idx = 0, (total 2040), set error_mark

echo -3500 > /sys/module/amvideo/parameters/omx_pts_interval_lower
echo -3000 > /sys/module/amvideo/parameters/omx_pts_interval_lower
echo 7000 > /sys/module/amvideo/parameters/omx_pts_interval_upper
echo -5500 > /sys/module/amvideo/parameters/omx_pts_interval_lower

echo -1500 > /sys/module/amvideo/parameters/omx_pts_interval_lower
echo 11000 > /sys/module/amvideo/parameters/omx_pts_interval_upper


20170727 9:30-21:05
1.
cat /sys/class/vdec/dump_vdec_blocks


2.
    enable trace vf frames:

echo 3 > /sys/module/aml_vfm/parameters/vfm_trace_enable

    same dump decoder related frames:

echo dump decoder > /sys/class/vfm/map

same for ppmgr deinterlace and other proveders;


20170728 09:26-18:40
1.
echo -1000 > /sys/module/amvideo/parameters/omx_pts_interval_lower

2.
echo 0x400000 > /sys/module/amvideo/parameters/debug_flag 


20180731 09:31-20:55
1.
Europes
[   51.201116@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[   51.317791@0] codec:system_time=11250, omx_pts=1, diff=11249
[   51.434449@0] codec:system_time=11251, omx_pts=1, diff=11250
[   51.551110@0] codec:system_time=11251, omx_pts=1, diff=11250
[   51.584462@0] codec:system_time=3751, omx_pts=15015, diff=-11264
[   51.667829@0] codec:system_time=23265, omx_pts=30030, diff=-6765

[  182.251158@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[  182.834491@0] codec:system_time=53250, omx_pts=42042, diff=11208
[  182.984518@0] codec:system_time=56292, omx_pts=45046, diff=11246


20170801 9:30-
1.1 ny
[  384.781870@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[  384.782856@0] codec:Try DW buffer for compressed frame scaling.
[  384.815288@0] codec:Try DW buffer for compressed frame scaling.
[  385.381889@0] codec:system_time=54750, omx_pts=43200, diff=11550

[  406.665209@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[  406.666214@0] codec:Try DW buffer for compressed frame scaling.
[  406.698670@0] codec:Try DW buffer for compressed frame scaling.
[  407.265200@0] codec:system_time=54750, omx_pts=43200, diff=11550
[  407.381879@0] codec:system_time=54450, omx_pts=43200, diff=11250

[  452.365431@0] [amvideo..] saturation_pre:32 hue_pre:0 mab:1400000
[  452.381909@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[  452.382996@0] codec:Try DW buffer for compressed frame scaling.
[  452.548554@0] codec:system_time=15750, omx_pts=21600, diff=-5850
[  452.915210@0] codec:system_time=55350, omx_pts=43200, diff=12150

[  478.765242@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[  478.766617@0] codec:Try DW buffer for compressed frame scaling.
[  478.798640@0] codec:Try DW buffer for compressed frame scaling.
[  479.331886@0] codec:system_time=51750, omx_pts=39600, diff=12150

[  500.465244@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[  500.466262@0] codec:Try DW buffer for compressed frame scaling.
[  500.498657@0] codec:Try DW buffer for compressed frame scaling.
[  501.065229@0] codec:system_time=54750, omx_pts=43200, diff=11550


1.2.europe
[  557.365260@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[  557.365682@0] codec:Try DW buffer for compressed frame scaling.
[  557.912129@3] BT_RADIO going: off
[  557.912160@3] BCM_BT: going OFF
[  557.941603@3] BT_RADIO going: on
[  557.941639@3] BCM_BT: going ON
[  557.948612@0] codec:system_time=53250, omx_pts=42042, diff=11208
[  558.361471@0] meson_uart c11084c0.serial: ttyS1 use xtal(8M) 24000000 change 2000000 to 2000000
[  558.364729@0] meson_uart c11084c0.serial: ttyS1 use xtal(8M) 24000000 change 2000000 to 115200
[  558.383781@3] meson_uart c11084c0.serial: ttyS1 use xtal(8M) 24000000 change 115200 to 2000000
[  558.398607@0] codec:system_time=83292, omx_pts=72073, diff=11219

[  579.748597@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[  579.749016@0] codec:Try DW buffer for compressed frame scaling.
[  579.782233@0] codec:Try DW buffer for compressed frame scaling.
[  580.331939@0] codec:system_time=53250, omx_pts=42042, diff=11208
[  580.448602@0] codec:system_time=53292, omx_pts=42042, diff=11250

[  601.465271@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[  601.465703@0] codec:Try DW buffer for compressed frame scaling.
[  601.498701@0] codec:Try DW buffer for compressed frame scaling.
[  601.586077@0] meson_uart c11084c0.serial: ttyS1 use xtal(8M) 24000000 change 2000000 to 2000000
[  601.600122@0] meson_uart c11084c0.serial: ttyS1 use xtal(8M) 24000000 change 2000000 to 115200
[  601.614429@3] meson_uart c11084c0.serial: ttyS1 use xtal(8M) 24000000 change 115200 to 2000000
[  602.048603@0] codec:system_time=53250, omx_pts=42042, diff=11208

[  620.115282@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[  620.115700@0] codec:Try DW buffer for compressed frame scaling.
[  620.148709@0] codec:Try DW buffer for compressed frame scaling.
[  620.154971@1] type=1400 audit(1501555567.628:294): avc: denied { ioctl } for pid=9585 comm="ay.happyplay.aw" path="socket:[37230]" dev="sockfs" ino=37230 ioctlcmd=8927 scontext=u:r:platform_app:s0:c512,c768 tcontext=u:r:platform_app:s0:c512,c768 tclass=udp_socket permissive=0
[  620.175188@0] type=1400 audit(1501555567.648:295): avc: denied { ioctl } for pid=9585 comm="ay.happyplay.aw" path="socket:[37230]" dev="sockfs" ino=37230 ioctlcmd=8927 scontext=u:r:platform_app:s0:c512,c768 tcontext=u:r:platform_app:s0:c512,c768 tclass=udp_socket permissive=0
[  620.698611@0] codec:system_time=53250, omx_pts=42042, diff=11208
[  620.815276@0] codec:system_time=53292, omx_pts=42042, diff=11250

2.1 ny
[  795.365343@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[  795.366409@0] codec:Try DW buffer for compressed frame scaling.
[  795.398786@0] codec:Try DW buffer for compressed frame scaling.
[  795.482006@0] codec:system_time=11250, omx_pts=1, diff=11249
[  795.598677@0] codec:system_time=11251, omx_pts=1, diff=11250
[  795.715344@0] codec:system_time=11251, omx_pts=1, diff=11250
[  795.748682@0] codec:system_time=3751, omx_pts=18000, diff=-14249
[  795.798721@0] codec:system_time=23250, omx_pts=28800, diff=-5550

[  825.598699@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[  825.599653@0] codec:Try DW buffer for compressed frame scaling.
[  825.715349@0] codec:system_time=11250, omx_pts=1, diff=11249
[  825.832010@0] codec:system_time=11251, omx_pts=1, diff=11250
[  825.948683@0] codec:system_time=11251, omx_pts=1, diff=11250
[  825.982015@0] codec:system_time=3751, omx_pts=14400, diff=-10649
[  826.015363@0] codec:system_time=18150, omx_pts=25200, diff=-7050


20170802 9:26-

1.europe
[ 1209.918998@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[ 1210.035664@0] codec:system_time=11250, omx_pts=1, diff=11249
[ 1210.152321@0] codec:system_time=11251, omx_pts=1, diff=11250
[ 1210.268985@0] codec:system_time=11251, omx_pts=1, diff=11250
[ 1210.335657@0] codec:system_time=6751, omx_pts=18019, diff=-11268
[ 1210.485733@0] codec:system_time=32269, omx_pts=39039, diff=-6770

2.
rideonboard
[ 1327.902365@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[ 1328.019037@0] codec:system_time=11250, omx_pts=1, diff=11249
[ 1328.135692@0] codec:system_time=11251, omx_pts=1, diff=11250
[ 1328.252358@0] codec:system_time=11251, omx_pts=1, diff=11250
[ 1328.302372@0] codec:system_time=5251, omx_pts=15015, diff=-9764
[ 1331.385700@0] codec:system_time=293265, omx_pts=298799, diff=-5534

3.wordcup
[ 1459.202411@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[ 1459.319076@0] codec:system_time=11250, omx_pts=1, diff=11249
[ 1459.435735@0] codec:system_time=11251, omx_pts=1, diff=11250
[ 1461.319101@0] codec:system_time=170251, omx_pts=177177, diff=-6926

4.normal kaoya
[ 1763.702536@0] codec:system_time=-268500, omx_pts=0, diff=-268500
[ 1763.819179@0] codec:system_time=11250, omx_pts=1, diff=11249
[ 1763.935852@0] codec:system_time=11251, omx_pts=1, diff=11250
[ 1764.019187@0] codec:system_time=8251, omx_pts=15015, diff=-6764

norway
[ 1856.502574@0] codec:system_time=-268500, omx_pts=1, diff=-268501
[ 1856.619218@0] codec:system_time=11251, omx_pts=1, diff=11250
[ 1856.736017@0] codec:system_time=11251, omx_pts=1, diff=11250
[ 1856.869223@0] codec:system_time=12751, omx_pts=18769, diff=-6018


第一次计算audio的pts不准

把音频的初始化时间变长
ny
[26869.378017@0] codec:system_time=11250, omx_pts=1, diff=11249
[26869.494674@0] codec:system_time=11251, omx_pts=1, diff=11250
[26869.611342@0] codec:system_time=11251, omx_pts=1, diff=11250
[26869.728015@0] codec:system_time=11251, omx_pts=1, diff=11250
[26869.844681@0] codec:system_time=11251, omx_pts=1, diff=11250
[26869.961346@0] codec:system_time=11251, omx_pts=1, diff=11250
[26870.078005@0] codec:system_time=11251, omx_pts=1, diff=11250
[26870.194675@0] codec:system_time=11251, omx_pts=1, diff=11250
[26870.311342@0] codec:system_time=11251, omx_pts=1, diff=11250
[26870.428009@0] codec:system_time=11251, omx_pts=1, diff=11250
[26871.911343@0] codec:system_time=134251, omx_pts=140400, diff=-6149
[26871.944693@0] codec:system_time=144150, omx_pts=151200, diff=-7050
[26871.994689@0] codec:system_time=156450, omx_pts=162000, diff=-5550
[26872.044691@0] codec:system_time=167250, omx_pts=172800, diff=-5550
[26872.094692@0] codec:system_time=178050, omx_pts=183600, diff=-5550
[26872.211342@0] codec:system_time=194850, omx_pts=201600, diff=-6750
[26872.261351@0] codec:system_time=206850, omx_pts=212400, diff=-5550
[26872.344677@0] codec:system_time=220650, omx_pts=226800, diff=-6150
[26872.394685@0] codec:system_time=232050, omx_pts=237600, diff=-5550
[26872.478014@0] codec:system_time=245850, omx_pts=252000, diff=-6150


[27016.878061@0] codec:system_time=11251, omx_pts=1, diff=11250
[27016.994728@0] codec:system_time=11251, omx_pts=1, diff=11250
[27017.111401@0] codec:system_time=11251, omx_pts=1, diff=11250
[27017.228100@0] codec:system_time=11251, omx_pts=1, diff=11250
[27017.344730@0] codec:system_time=11251, omx_pts=1, diff=11250
[27017.578057@0] codec:system_time=11251, omx_pts=1, diff=11250
[27017.694728@0] codec:system_time=11251, omx_pts=1, diff=11250
[27017.811392@0] codec:system_time=11251, omx_pts=1, diff=11250
[27018.011408@0] codec:system_time=18751, omx_pts=7507, diff=11244
[27019.294729@0] codec:system_time=123757, omx_pts=112612, diff=11145
[27020.894746@0] codec:system_time=257362, omx_pts=246247, diff=11115
[27022.811414@0] codec:system_time=419497, omx_pts=408409, diff=11088
[27025.194730@0] codec:system_time=623659, omx_pts=612613, diff=11046
[27025.894754@0] codec:system_time=676363, omx_pts=665164, diff=11199
[27026.794739@0] codec:system_time=746914, omx_pts=735735, diff=11179
[27028.111402@0] codec:system_time=854985, omx_pts=843843, diff=11142
[27029.811411@0] codec:system_time=997593, omx_pts=986485, diff=11108
[27032.244760@0] codec:system_time=1204735, omx_pts=1193692, diff=11043
[27034.078075@0] codec:system_time=1359442, omx_pts=1348347, diff=11095
[27035.811413@0] codec:system_time=1505097, omx_pts=1493992, diff=11105



20170807 9:40-
1.
    if (seekTimeUs >= 0) {
        if (mDVTrack.mSource != NULL) {
            seeking = false;
        } else {
            options.setSeekTo(seekTimeUs, MediaSource::ReadOptions::SEEK_PREVIOUS_SYNC);
            seeking = true;
            Vector<MediaBuffer*>::iterator it = mDVMediaBuffer.begin();
            while (it != mDVMediaBuffer.end()) {
                MediaBuffer *mediabuf = *it;
                mediabuf->release();
                ++it;
            }
            mDVMediaBuffer.clear();
        }
    }
	
	        //close dv seek function for temporary
			
2.
216681
149939
166676

20170808 9:40-22:20
1.
cat /sys/class/vfm/map

20170810 9:30-21:20
1.
wplay http://10.68.8.39/video/test/test.m3u8 && logcat -v threadtime

20170811 9:30-
1.
echo rm default > /sys/class/vfm/map
echo add default decoder amlvideo amvideo > /sys/class/vfm/map
chmod 444  /sys/class/vfm/map 可以防止omx改变

decoder(1) amlvideo(1) deinterlace(1) amvideo

echo rm default > /sys/class/vfm/map && echo add default decoder amlvideo amvideo > /sys/class/vfm/map
chmod 444  /sys/class/vfm/map

2.
echo dump decoder.h264 > /sys/class/vfm/map


20170814 9:30-
1.
am start -n com.android.gallery3d/.app.MovieActivity -d

dumpsys SurfaceFlinger --latency "SurfaceView - com.android.gallery3d/com.android.gallery3d.app.MovieActivity"
dumpsys SurfaceFlinger --latency "SurfaceView - com.android.gallery3d/com.android.gallery3d.app.MovieActivity"

http://10.68.11.54:8000/HLS/rabbit/rabbit.m3u8
http://10.68.11.54:8000/hb/doctorx_min/playlist.m3u8

2.
c782b16965aa7f27e0d9610b895b3932baf887bf


20170816 9:40-21:20
1.
http://edgewarelive.edgeware.qa.tvb.com/__cl/default/__c/ott_J_hevc/__op/verimatrix/__f/index.m3u8?sig=e7ff055e3d9d4c9a9e6330644253f144&ext_start_limit=1505373358&int_start_limit=1505373358&ts=1505373358&c=multicdn



20170817 9:15-22:10
1.
10900
1001012
100104


20170821 9:30-20:40
1.卡住
mount -o rw,remount /dev/block/system  /system
cat /sys/class/vfm/map
echo dump vdec.h264.00 > map

2.
195
/storage/9A54374E54372C7F/video/AVC-AAC-LC-1257 Kbps-640x480.m4v

198 一个文件
/storage/B82A-D801/video/AVC-AAC-1056Kbps-1280x720.mp4

199
/storage/2A0C-5B51/video/AVC-DTS&AC3-14.2 Mbps-1920x1080.TS


20170823 9:40-20:50
1.
	两路煲机
   11386 01-01 00:09:13.710  4054  4223 E BufferQueueConsumer: [SurfaceView - com.droidlogic.media/com.droidlogic.media.PlayerActivity] acquireBuffer: max acquired buf         fer count reached: 2 (max 1)
   11387 
   11388 01-01 00:09:13.710  4054  4223 E SurfaceFlinger: updateTexImage: acquire failed: Function not implemented (-38)

2. multidec
149117
4路60fps 720P VP9
3路60fps VP9+1路H264
3路60fps VP9+1路60fps H265
2路60fps VP9+2路60fps H265
2路60Fps VP9+1路60fps H265＋1路h264：60fps VP9/h265会卡住
现象：以上组合中VP9和H265视频会卡住不动

149110
4路 30fps（或者60fps) 720P H265

20170824 9:40-21:05
1.‘
liumeng
2729400584


20170825 9:40-
1.
nuplayer
08-25 02:11:37.873  3174  5304 I AmFFmpegExtractor: packet->stream_index=3, length=1028
08-25 02:11:38.186  3174  3633 I AmFFmpegExtractor: packet->stream_index=3, length=1139
08-25 02:11:40.140  3174  5304 I AmFFmpegExtractor: packet->stream_index=3, length=1701
08-25 02:11:43.913  3174  3174 I AmFFmpegExtractor: packet->stream_index=3, length=478
08-25 02:11:47.377  3174  5304 I AmFFmpegExtractor: packet->stream_index=3, length=531
08-25 02:12:00.270  3174  3633 I AmFFmpegExtractor: packet->stream_index=3, length=917
08-25 02:12:03.883  3174  3224 I AmFFmpegExtractor: packet->stream_index=3, length=450
08-25 02:12:07.140  3174  5303 I AmFFmpegExtractor: packet->stream_index=3, length=1801
08-25 02:12:09.383  3174  5304 I AmFFmpegExtractor: packet->stream_index=3, length=1407
08-25 02:12:13.759  3174  5304 I AmFFmpegExtractor: packet->stream_index=3, length=1993
08-25 02:12:16.274  3174  5303 I AmFFmpegExtractor: packet->stream_index=3, length=1786
08-25 02:12:20.419  3174  3224 I AmFFmpegExtractor: packet->stream_index=3, length=1482
08-25 02:12:24.670  3174  5303 I AmFFmpegExtractor: packet->stream_index=3, length=1235
08-25 02:12:28.420  3174  3633 I AmFFmpegExtractor: packet->stream_index=3, length=1888
08-25 02:12:33.212  3174  3633 I AmFFmpegExtractor: packet->stream_index=3, length=872

libplayer
08-25 02:24:41.511 13709 13724 I amplayer: wsl stream_index=3, size=2264
08-25 02:24:44.777 13709 13724 I amplayer: wsl stream_index=3, size=2380
08-25 02:24:48.554 13709 13724 I amplayer: wsl stream_index=3, size=2912
08-25 02:24:51.547 13709 13724 I amplayer: wsl stream_index=3, size=1472
08-25 02:25:04.213 13709 13724 I amplayer: wsl stream_index=3, size=1524
08-25 02:25:06.819 13709 13724 I amplayer: wsl stream_index=3, size=2044
08-25 02:25:09.020 13709 13724 I amplayer: wsl stream_index=3, size=1484
08-25 02:25:12.140 13709 13724 I amplayer: wsl stream_index=3, size=3432
08-25 02:25:16.258 13709 13724 I amplayer: wsl stream_index=3, size=2596
08-25 02:25:19.579 13709 13724 I amplayer: wsl stream_index=3, size=3260
08-25 02:25:24.074 13709 13724 I amplayer: wsl stream_index=3, size=3032
08-25 02:25:27.840 13709 13724 I amplayer: wsl stream_index=3, size=2696
08-25 02:25:32.342 13709 13724 I amplayer: wsl stream_index=3, size=2376
08-25 02:25:34.700 13709 13724 I amplayer: wsl stream_index=3, size=3228
08-25 02:26:22.166 13709 13724 I amplayer: wsl stream_index=3, size=1972
08-25 02:26:23.177 13709 13724 I amplayer: wsl stream_index=3, size=2760
08-25 02:26:24.781 13709 13724 I amplayer: wsl stream_index=3, size=3092

20170828 9:30-20:20
1.
176 177
/storage/01D2CD6FF94CA760/dobly version/[SUHD]Journey_of_Color.ts
2,
Bug 149105 - {AV} S905X-Multi-dec:1路60FPS 1080p H265和1路4kh264（或4KH265），播放时1080P H265会卡住 概率：100％ 对比：Hi3798CV200，Hi3798MV200正常
Bug 149108 - {AV}S905X-Multi-dec: 一路30FP3（或者60FPS）1080P VP9和一路4KH264播放时，VP9播放几秒视频会卡住 概率：100％ 对比：Hi3798CV200，Hi3798MV200正常
Bug 149109 - {AV} S905X-Multi-dec: 一路60FPS 1080P VP9和一路4KH265播放时，VP9播放几秒视频会卡住 概率：100％ 对比：Hi3798CV200，Hi3798MV200正常
Bug 149110 - {AV} S905X-Multi-dec: 4路30fps（或者60fps)720P H265，播放时很卡，特别是60FPS的，播放几秒4路就会卡住不动 概率：100％ 对比：Hi3798MV200偶尔有卡顿 
Bug 149117 - {AV} S905X-Multi-dec:4路720p解码不同组合中60FPS VP9播放视频会卡住不动 概率：100％ 对比：Hi3798MV200没有卡住的问题 
Bug 145335 - {AV} S905X－Multiplayer，add第一路1080p，第二路4k h264/h265，播放时第一路1080p视频播放很卡，第二路4K播放流畅 概率：100％ 对比：新功能无需对比
Bug 145965 - {AV} S905X-Multi-dec，add 6路 480p 30fps h264/h265/vp9，任意组合播放，6路画面都很卡，有时其中几路画面会卡住不动 概率：100％ 对比：Hi3798MV200情况差不多
Bug 145972 - {AV} S905X-Multi-dec, add一路1080P 30fps h264视频，一路4K 30FPS H264,播放中，4K 30FPS H264卡顿 概率：100％ 对比：Hi3798MV200,Hi3798CV200正常 

3
92 mediascan crash
/mnt/media_rw/2E3273343273005F/深圳拷贝4K文件/4K file-MID/4K H264/60fps/[4KH264_50.000fps_155Mbps_8bit]InToTree_2160p50.x264.CRF24.mkv
08-25 22:29:17.144  5341  5341 E         : ntfs_attr_pread_i: ntfs_pread failed
08-25 22:29:17.144  5341  5341 E Ntfs-3g : ntfs_attr_pread error reading '/深圳拷贝4K文件/4K file-MID/4K H264/60fps/[4KH264_50.000fps_247Mbps_8bit]OldTownCross_2160p50.x264.CRF24.mkv' at offset 0: 16384 <> -1
08-25 22:29:17.144  5341  5341 E         : ntfs_attr_pread_i: ntfs_pread failed
08-25 22:29:17.330  5516  5516 F DEBUG   : backtrace:
08-25 22:29:17.330  5516  5516 F DEBUG   :     #00 pc 0004a154  /system/lib/libc.so (tgkill+12)
08-25 22:29:17.330  5516  5516 F DEBUG   :     #01 pc 000478f3  /system/lib/libc.so (pthread_kill+34)
08-25 22:29:17.330  5516  5516 F DEBUG   :     #02 pc 0001dc15  /system/lib/libc.so (raise+10)
08-25 22:29:17.330  5516  5516 F DEBUG   :     #03 pc 00019761  /system/lib/libc.so (__libc_android_abort+34)
08-25 22:29:17.330  5516  5516 F DEBUG   :     #04 pc 00017348  /system/lib/libc.so (abort+4)
08-25 22:29:17.330  5516  5516 F DEBUG   :     #05 pc 00727ce0  /system/lib/libamffmpeg.so
08-25 22:29:17.330  5516  5516 F DEBUG   :     #06 pc 00769308  /system/lib/libamffmpeg.so (av_probe_input_format3+388)
08-25 22:29:17.330  5516  5516 F DEBUG   :     #07 pc 007694d4  /system/lib/libamffmpeg.so (av_probe_input_format2+32)
08-25 22:29:17.330  5516  5516 F DEBUG   :     #08 pc 0000cd94  /system/lib/libamffmpegadapter.so (_ZN7android11probeFormatERKNS_2spINS_10DataSourceEEE+120)
08-25 22:29:17.330  5516  5516 F DEBUG   :     #09 pc 00004f60  /system/lib/libamlogic_metadata_retriever.so (_ZN7android14AmThumbnailInt24amthumbnail_decoder_openERKNS_2spINS_10DataSourceEEEb+152)
08-25 22:29:17.330  5516  5516 F DEBUG   :     #10 pc 00004003  /system/lib/libamlogic_metadata_retriever.so (_ZN7android26AmlPlayerMetadataRetriever13setDataSourceERKNS_2spINS_10DataSourceEEE+46)
08-25 22:29:17.330  5516  5516 F DEBUG   :     #11 pc 00040ce3  /system/lib/libmediaplayerservice.so (_ZN7android23MetadataRetrieverClient13setDataSourceEixx+226)
08-25 22:29:17.330  5516  5516 F DEBUG   :     #12 pc 00099019  /system/lib/libmedia.so (_ZN7android24BnMediaMetadataRetriever10onTransactEjRKNS_6ParcelEPS1_j+444)
08-25 22:29:17.330  5516  5516 F DEBUG   :     #13 pc 000359c3  /system/lib/libbinder.so (_ZN7android7BBinder8transactEjRKNS_6ParcelEPS1_j+70)

4.
http://firmware.myamlogic.com/shanghai/image/android/Android-N/BOX//patchbuild/2017-08-28/p212-userdebug-64-DRM-164


20170819 9:30-21:00

20170830 9:35-21:20
1. 10s开始闪
101frame 一个idr
23*10=230

20180831 9:30-21:20
1.
使用ves_splitter，处理后的bl与合并前一样的，el除了rpu之外其它也是一样的，可以排除是合并的问题


20170901 9:30-23:15
1.
1. Brian使用c mode对合成的流解析，发现48帧的md值差距大，怀疑metadata有问题
2. 确认流合成的问题
2.1 demux出来bl和el（el + rpu）两路视频。合并后的流我用ves_splitter工具解析后的bl与demux出来(合成前)的一样，解析后的el和demux出来的el就差rpu，
其它都一样，而rpu也只是根据00 00 00 01 7c 01 判定提取的，没做其它处理。流合成没有发现问题
2.2 第三方平台（能放dv的）不能识别h265 es流，也没法确认合成流的问题
3.确认demux数据是否有问题
使用我们用的ffmpeg和其它的版的确认了demux的数据，也是正常的

2.
echo 1 >  /sys/class/decoder_bmmu_box/debug 

                   maxBuffers = 4;
            }
            break;
        case MEDIA_TRACK_TYPE_AUDIO:
            track = &mAudioTrack;
            if (mIsWidevine) {
                maxBuffers = 8;
            } else {
                if (mIsUdp)
                    maxBuffers = 1;
                else
                    maxBuffers = 1;

20170902 9:56-
1.
10:00
20-26  6分钟出现花屏
28-30  20170902_4vp9kernel_1.log

11:00
22-27    20170902_4vp9kernel_3.log dump数据， 扫描时出现crash
copy到flash上
39-46      20170902_4vp9kernel_4.log dump数据


14
03-   20170902_4vp9kernel_10.log video


2.

repo init -u git://git.myamlogic.com/platform/manifest -b m-amlogic --repo-url=git://10.8.9.5/tools/repo.git 



20170904
1.
bootable/recovery/ubootenv/uboot_env.c:90:11: warning: assignment discards 'const' qualifier from pointer target type
     value = optarg + strlen(name) + 1;
           ^
bootable/recovery/ubootenv/uboot_env.c:109:9: error: implicit declaration of function 'free' [-Werror=implicit-function-declaration]
         free(buffer);
         ^
bootable/recovery/ubootenv/uboot_env.c:109:9: warning: incompatible implicit declaration of built-in function 'free'
target  C: static_busybox <= external/busybox/archival/cpio.c
target  C: static_busybox <= external/busybox/archival/gzip.c
target  C: static_busybox <= external/busybox/archival/libarchive/lzo1x_1.c
1 warning generated.
target  C: static_busybox <= external/busybox/archival/libarchive/lzo1x_1o.c


external/busybox/android/librpc/clnt_unix.c: In function 'clntunix_create':
external/busybox/android/librpc/clnt_unix.c:149:7: error: implicit declaration of function 'strlen' [-Werror=implicit-function-declaration]
       len = strlen (raddr->sun_path) + sizeof (raddr->sun_family) + 1;
       ^
external/busybox/android/librpc/clnt_unix.c:149:13: warning: incompatible implicit declaration of built-in function 'strlen'
       len = strlen (raddr->sun_path) + sizeof (raddr->sun_family) + 1;
             ^
external/busybox/android/librpc/clnt_unix.c: In function '__msgwrite':
external/busybox/android/librpc/clnt_unix.c:504:3: error: implicit declaration of function 'memcpy' [-Werror=implicit-function-declaration]
   memcpy (CMSG_DATA(cmsg), &cred, sizeof (struct ucred));
   ^
external/busybox/android/librpc/clnt_unix.c:504:3: warning: incompatible implicit declaration of built-in function 'memcpy'
target  C: libuclibcrpc <= external/busybox/android/librpc/svc_udp.c
target  C: libuclibcrpc <= external/busybox/android/librpc/svc_unix.c
external/busybox/android/librpc/clnt_udp.c: In function 'clntudp_call':
external/busybox/android/librpc/clnt_udp.c:402:8: error: implicit declaration of function 'memcmp' [-Werror=implicit-function-declaration]
        && memcmp (cbuf + 256, cu->cu_outbuf, ret) == 0
        ^
target  C: libuclibcrpc <= external/busybox/android/librpc/xdr_array.c
target  C: libuclibcrpc <= external/busybox/android/librpc/xdr.c
target  C: libuclibcrpc <= external/busybox/android/librpc/xdr_float.c
external/busybox/android/librpc/svc.c: In function 'svc_getreqset':
external/busybox/android/librpc/svc.c:455:5: error: implicit declaration of function 'ffs' [-Werror=implicit-function-declaration]


  where Params is a type-variable:
    Params extends Object declared in class AsyncTask
out/target/common/obj/JAVA_LIBRARIES/android_stubs_current_intermediates/src/android/os/AsyncTask.java:26: warning: [unchecked] Possible heap pollution from parameterized vararg type Params
public final  android.os.AsyncTask<Params, Progress, Result> executeOnExecutor(java.util.concurrent.Executor exec, Params... params) { throw new RuntimeException("Stub!"); }
                                                                                                             ^
  where Params is a type-variable:
    Params extends Object declared in class AsyncTask
out/target/common/obj/JAVA_LIBRARIES/android_stubs_current_intermediates/src/android/os/AsyncTask.java:28: warning: [unchecked] Possible heap pollution from parameterized vararg type Progress
protected final  void publishProgress(Progress... values) { throw new RuntimeException("Stub!"); }
                                                  ^
  where Progress is a type-variable:
    Progress extends Object declared in class AsyncTask
ERROR: /mnt/fileroot/shuanglong.wang/m-amlogic/vendor/amlogic/apps/MboxLauncher2/src/com/droidlogic/mboxlauncher/Launcher.java:191: N_MR1 cannot be resolved or is not a field
Install: out/target/product/p201/system/app/Miracast/Miracast.apk
Install: out/target/product/p201/system/priv-app/FusedLocation/FusedLocation.apk
make: *** [out/target/common/obj/APPS/MboxLauncher_intermediates/with-local/classes.dex] Error 41
make: *** Waiting for unfinished jobs....
out/target/common/obj/JAVA_LIBRARIES/android_stubs_current_intermediates/src/android/test/suitebuilder/TestSuiteBuilder.java:19: warning: [unchecked] Possible heap pollution from parameterized vararg type Predicate<TestMethod>
public final  android.test.suitebuilder.TestSuiteBuilder addRequirements(com.android.internal.util.Predicate<android.test.suitebuilder.TestMethod>... predicates) { throw new RuntimeException("Stub!"); }
                                                                                                                                                      ^
out/target/common/obj/JAVA_LIBRARIES/android_stubs_current_intermediates/src/android/app/ActivityOptions.java:10: warning: [unchecked] Possible heap pollution from parameterized vararg type Pair<View,String>
public static  android.app.ActivityOptions makeSceneTransitionAnimation(android.app.Activity activity, android.util.Pair<android.view.View, java.lang.String>... sharedElements) { throw new RuntimeException("Stub!"); }
                                                                                             ^
out/target/common/obj/JAVA_LIBRARIES/android_stubs_current_intermediates/src/java/util/concurrent/ScheduledThreadPoolExecutor.java:6: warning: [unchecked] unchecked conversion
public  ScheduledThreadPoolExecutor(int corePoolSize) { super(0,0,0,(java.util.concurrent.TimeUnit)null,(java.util.concurrent.BlockingQueue)null,(java.util.concurrent.ThreadFactory)null,(java.util.concurrent.RejectedExecutionHandler)null); throw new RuntimeException("Stub!"); }
                                                                                                        ^
  required: BlockingQueue<Runnable>
  found:    BlockingQueue
out/target/common/obj/JAVA_LIBRARIES/android_stubs_current_intermediates/src/java/util/concurrent/ScheduledThreadPoolExecutor.java:7: warning: [unchecked] unchecked conversion
public  ScheduledThreadPoolExecutor(int corePoolSize, java.util.concurrent.ThreadFactory threadFactory) { super(0,0,0,(java.util.concurrent.TimeUnit)null,(java.util.concurrent.BlockingQueue)null,(java.util.concurrent.ThreadFactory)null,(java.util.concurrent.RejectedExecutionHandler)null); throw new RuntimeException("Stub!"); }
                                                                                                                                                          ^
  required: BlockingQueue<Runnable>
  found:    BlockingQueue
out/target/common/obj/JAVA_LIBRARIES/android_stubs_current_intermediates/src/java/util/concurrent/ScheduledThreadPoolExecutor.java:8: warning: [unchecked] unchecked conversion
public  ScheduledThreadPoolExecutor(int corePoolSize, java.util.concurrent.RejectedExecutionHandler handler) { super(0,0,0,(java.util.concurrent.TimeUnit)null,(java.util.concurrent.BlockingQueue)null,(java.util.concurrent.ThreadFactory)null,(java.util.concurrent.RejectedExecutionHandler)null); throw new RuntimeException("Stub!"); }
                                                                                                                                                               ^
  required: BlockingQueue<Runnable>
  found:    BlockingQueue
out/target/common/obj/JAVA_LIBRARIES/android_stubs_current_intermediates/src/java/util/concurrent/ScheduledThreadPoolExecutor.java:9: warning: [unchecked] unchecked conversion
public  ScheduledThreadPoolExecutor(int corePoolSize, java.util.concurrent.ThreadFactory threadFactory, java.util.concurrent.RejectedExecutionHandler handler) { super(0,0,0,(java.util.concurrent.TimeUnit)null,(java.util.concurrent.BlockingQueue)null,(java.util.concurrent.ThreadFactory)null,(java.util.concurrent.RejectedExecutionHandler)null); throw new RuntimeException("Stub!"); }
                                                                                                                                                                                                                 ^
  required: BlockingQueue<Runnable>
  found:    BlockingQueue
out/target/common/obj/JAVA_LIBRARIES/android_stubs_current_intermediates/src/java/security/cert/PKIXBuilderParameters.java:5: warning: [unchecked] unchecked conversion
public  PKIXBuilderParameters(java.util.Set<java.security.cert.TrustAnchor> trustAnchors, java.security.cert.CertSelector targetConstraints) throws java.security.InvalidAlgorithmParameterException { super((java.util.Set)null); throw new RuntimeException("Stub!"); }
                                                                                                                                                                                                             ^
  required: Set<TrustAnchor>
  found:    Set
Note: Some input files use or override a deprecated API.
Note: Recompile with -Xlint:deprecation for details.
23 warnings


20170904 9:30-21:10
1.
Bug 150266 - [烽火海外IPTV-S905X-7.1-自测-video]：《栋笃神探01.mkv》、《圆月弯刀12.mkv》字幕视频，切换音轨会出现画面卡顿，声音正常
Bug 149551 - [Ref#150015-R32A2-Video]:本地播放4KH265-30片源，seek到3分20秒左右画面卡住但声音正常 -必现[对比公版可复现]


20170905 9:35-
1.上周
dolby 双路闪屏问题，metadata是跟bl层，还是el层，reorder的问题，需要robin分析修改
多路卡住，目前还有花屏的问题，dump数据没错
煲机的问题，全格式文件结尾的eos的判定修改，dv的煲机是解码器卡住了，需要rain分析下
解码不支持的问题，对于没有extradata的音频是aac，才走使用adts

20170907 9:36-
1.
14968361 01-02 17:21:53.885  3260 13278 I amffmpeg: [av_estimate_timings:3477]file_size=36700160 valid_offset=2300000
14968362 01-02 17:21:53.886  3260 13277 I amplayer: [player_thread_wait_exit:80]pid=[17] thead_id=3818916128
14968363 01-02 17:21:53.890  3260 13278 I amffmpeg: url_resetbuf--4096
crash可能crash在时间的探测上
av_estimate_timings

20170910 9:45-18:30
1.
if (mIsAudio)
            mRenderer->setHasNoMedia(true /*audio*/);
			
2.omxcodec
GetFileType---Type=webm,vp8,videos=1,audios=0



20170911 9:40-22:20
1.
h264.c
frameworks/av/services/audioflinger/AudioResamplerDyn.cpp
vendor/amlogic/frameworks/av/LibPlayer/amplayer/player/player_hwdec.c
external/flac/libFLAC/stream_decoder.c

testStagefright_bug_22771132连测8次，通过


20170912 9:35-22:15
1.连续测8次，OK
testStagefright_cve_2016_2429_b_27211885  ok
kernle + 
09-11 16:07:15.923 F/DEBUG   ( 3716):     #00 pc 00055dca  /system/lib/libc.so (ifree+49)
09-11 16:07:15.924 F/DEBUG   ( 3716):     #01 pc 00058d43  /system/lib/libc.so (je_free+374)
09-11 16:07:15.924 F/DEBUG   ( 3716):     #02 pc 000f8860  /system/lib/libstagefright.so
09-11 16:07:15.924 F/DEBUG   ( 3716):     #03 pc 000f9778  /system/lib/libstagefright.so (FLAC__stream_decoder_process_until_end_of_metadata+72)
09-11 16:07:15.924 F/DEBUG   ( 3716):     #04 pc 00084641  /system/lib/libstagefright.so (_ZN7android10FLACParser4initEv+156)
09-11 16:07:15.924 F/DEBUG   ( 3716):     #05 pc 00084a39  /system/lib/libstagefright.so (_ZN7android10FLACParserC2ERKNS_2spINS_10DataSourceEEERKNS1_INS_8MetaDataEEES9_+140)
09-11 16:07:15.924 F/DEBUG   ( 3716):     #06 pc 00084ab7  /system/lib/libstagefright.so (_ZN7android13FLACExtractor4initEv+98)
09-11 16:07:15.924 F/DEBUG   ( 3716):     #07 pc 00084b05  /system/lib/libstagefright.so (_ZN7android13FLACExtractorC1ERKNS_2spINS_10DataSourceEEE+48)
09-11 16:07:15.924 F/DEBUG   ( 3716):     #08 pc 000a1e79  /system/lib/libstagefright.so (_ZN7android14MediaExtractor6CreateERKNS_2spINS_10DataSourceEEEPKc+688)
09-11 16:07:15.924 F/DEBUG   ( 3716):     #09 pc 000a7437  /system/lib/libstagefright.so (_ZN7android16NuMediaExtractor13setDataSourceEixx+114)
09-11 16:07:15.924 F/DEBUG   ( 3716):     #10 pc 00023be1  /system/lib/libmedia_jni.so

2.
testStagefright_bug_21443020
https://android.googlesource.com/platform/cts/+/android-cts-6.0_r21/tests/tests/security/src/android/security/cts/StagefrightTest.java
09-11 16:23:34.697 F/DEBUG   ( 3716): Abort message: 'frameworks/av/media/libstagefright/OMXCodec.cpp:4393 CHECK_EQ( (int)mPortStatus[kPortIndexOutput],(int)ENABLED) failed: 1 vs. 0'
09-11 16:23:34.697 E/DEBUG   ( 3716): AM write failed: Broken pipe
09-11 16:23:34.697 F/DEBUG   ( 3716):     r0 00000000  r1 00001cd2  r2 00000006  r3 f1aff978
09-11 16:23:34.697 F/DEBUG   ( 3716):     r4 f1aff980  r5 f1aff930  r6 00000002  r7 0000010c
09-11 16:23:34.697 F/DEBUG   ( 3716):     r8 00000000  r9 f438cbb4  sl f4382f88  fp f1aff7a4
09-11 16:23:34.697 F/DEBUG   ( 3716):     ip 00000006  sp f1aff328  lr f6c3b48d  pc f6c3d888  cpsr 40070010
09-11 16:23:34.712 F/DEBUG   ( 3716): 
09-11 16:23:34.712 F/DEBUG   ( 3716): backtrace:
09-11 16:23:34.712 F/DEBUG   ( 3716):     #00 pc 00042888  /system/lib/libc.so (tgkill+12)
09-11 16:23:34.713 F/DEBUG   ( 3716):     #01 pc 00040489  /system/lib/libc.so (pthread_kill+32)
09-11 16:23:34.713 F/DEBUG   ( 3716):     #02 pc 0001cb0f  /system/lib/libc.so (raise+10)
09-11 16:23:34.713 F/DEBUG   ( 3716):     #03 pc 00019cb1  /system/lib/libc.so (__libc_android_abort+34)
09-11 16:23:34.713 F/DEBUG   ( 3716):     #04 pc 00017a64  /system/lib/libc.so (abort+4)
09-11 16:23:34.713 F/DEBUG   ( 3716):     #05 pc 00008933  /system/lib/libcutils.so (__android_log_assert+86)
09-11 16:23:34.713 F/DEBUG   ( 3716):     #06 pc 000aec6d  /system/lib/libstagefright.so (_ZN7android8OMXCodec20signalBufferReturnedEPNS_11MediaBufferE+204)
09-11 16:23:34.714 F/DEBUG   ( 3716):     #07 pc 000952bd  /system/lib/libstagefright.so (_ZN7android11MediaBuffer7releaseEv+160)
09-11 16:23:34.714 F/DEBUG   ( 3716):     #08 pc 0007c5f3  /system/lib/libstagefright.so (_ZN7android13AwesomePlayer12onVideoEventEv+1258)
09-11 16:23:34.714 F/DEBUG   ( 3716):     #09 pc 000b9819  /system/lib/libstagefright.so (_ZN7android15TimedEventQueue11threadEntryEv+368)
09-11 16:23:34.714 F/DEBUG   ( 3716):     #10 pc 000b9869  /system/lib/libstagefright.so (_ZN7android15TimedEventQueue13ThreadWrapperEPv+16)
09-11 16:23:34.714 F/DEBUG   ( 3716):     #11 pc 0003fd8b  /system/lib/libc.so (_ZL15__pthread_startPv+30)
09-11 16:23:34.715 F/DEBUG   ( 3716):     #12 pc 0001a345  /system/lib/libc.so (__start_thread+6)

3.
testDecoder
----- begin exception -----
09-11 19:45:50.504 I/TestRunner( 8752): junit.framework.AssertionFailedError: different decoded data
最后一个数据不对

20170913 9:30-19:00
1.
-    CHECK_EQ((int)info->mStatus, (int)OWNED_BY_US);
+    //CHECK_EQ((int)info->mStatus, (int)OWNED_BY_US);
+    if (info->mStatus != OWNED_BY_US)
+       return UNKNOWN_ERROR;   
     info->mStatus = OWNED_BY_CLIENT;
-
+    if(!info->mMediaBuffer)
+       goto refill;



20170914 9:40-20:10
1.给海博新的patch确认字幕的问题
2.cts反馈，测试过的概率还可以

20170915 9:40-18：55
1.
Affected Repositories:
  http://scgit.amlogic.com:8080/29814

Fix Summary:
  PD# 147221  :modify computePts stragety when all pts and dts have N/A

Reviewer(s) Requested:
   zhi.zhou@amlogic.com
   
Testing Suggestion:
	1.merge the difference
	2.compile libamffmpegadapter.so in path "vendor/amlogic/frameworks/av/AmFFmpegAdapter"
	3.replace compiled libamffmpegadapter.so in board and restart. libamffmpegadapter.so have upload to ftp "/private_build/Bug147221"

2.
目前公版上没有发现卡住和h265 30fps很卡的现象
本地测试视频：
[720Ph265_30.000fps_18.1Mbps]Wetek-Astra-2m.mp4
[720Ph265_30.000fps_27.1Mbps]Wetek-Astra-2m.mp4
[720Ph265_30.000fps_34.6Mbps]Wetek-Astra-2m.mp4
[720Ph265_30.000fps_41.5Mbps]Wetek-Astra-2m.mp4

请确认，如有问题请告知测试视频，方便复现

3.seek到固定点
6224007667


20170918 9:40-21:10
1.
pid: 18462, tid: 18696, name: RenderThread  >>> com.google.android.tvlauncher <<<

while [ true ];do procrank; sleep 10; done &

https://bugzilla-bj.amlogic.com/show_bug.cgi?id=148747
https://bugzilla-bj.amlogic.com/show_bug.cgi?id=148069

2.
echo 1 > /sys/module/amvdec_h265/parameters/dolby_meta_with_el
echo 3 > /sys/module/am_vecm/parameters/debug_dolby
echo 0 > /sys/module/am_vecm/parameters/debug_dolby

echo 0 > /sys/module/am_vecm/parameters/debug_dolby

cat /sys/class/amvecm/dv_mode

pr_info("dolby data beg:\n");
        for (i = 0; i < req.aux_size; i++) {
            pr_info("%#x", p[i]);
        }
        pr_info("dolby data end:\n"
		

20170919 9:40-20:05		
单帧调试dv
echo 0x83 > /sys/module/am_vecm/parameters/debug_dolby
echo 0x4 > /sys/module/am_vecm/parameters/dolby_vision_flags
while [ true ];do echo 0x4 > /sys/module/am_vecm/parameters/dolby_vision_flags; sleep 0.5;done
echo 0x4 > /sys/module/am_vecm/parameters/dolby_vision_flags


20170920 9:50-20:10
1.
#define MAXNUM_64BIT_SIGNEDINT (1ll << 63)       
        ALOGI("2222222222222222222,x=%lld y=%lld",x, y);
        if (x * x >= MAXNUM_64BIT_SIGNEDINT ||
            y * y >= MAXNUM_64BIT_SIGNEDINT ||
            x * y >= MAXNUM_64BIT_SIGNEDINT ||
            x * y <= -MAXNUM_64BIT_SIGNEDINT)
            return false;


20170921 9:25-
1.ACodec::setVideoPortFormatType导致视频不能播放

2.
    if (predictedPTSInUs == kUnknownPTS) {
        if (dtsFromFFmpeg < mStartTimeUs) {
            normalizedPTSInUs = dtsFromFFmpeg;
        } else {
            normalizedPTSInUs = dtsFromFFmpeg - mStartTimeUs;
        }    
    } else {
        if (predictedPTSInUs - mStartTimeUs < 0 && predictedPTSInUs - mStartTimeUs > -10) {
            normalizedPTSInUs = 0;
        } else if (predictedPTSInUs < mStartTimeUs) {
            normalizedPTSInUs = predictedPTSInUs;
        } else {
            normalizedPTSInUs = predictedPTSInUs - mStartTimeUs;
        }

    }
3.
此问题与bug146348是同一问题，请在r311平台验证

Affected Repositories:
  http://scgit.amlogic.com:8080/30940

Fix Summary:
  PD# 146348  :av: adjust pts when some stream pts not normal.

Reviewer(s) Requested:
   zhi.zhou@amlogic.com
   
Testing Suggestion:
	1.merge the difference
	2.compile libamffmpegadapter.so in path "vendor/amlogic/frameworks/av/AmFFmpegAdapter"
	3.replace compiled libamffmpegadapter.so in board and restart. libamffmpegadapter.so have upload to ftp "/private_build/Bug147221"

	
	libomx_av_core_alt.so
	
20180925 9:30-19:50
1.omx wmv3
http://scgit.amlogic.com:8080/#/c/30979/
http://scgit.amlogic.com:8080/#/c/30997/	

2.
http://scgit.amlogic.com:8080/#/c/29588/
http://scgit.amlogic.com:8080/#/c/29949/


4路vp9的kernel异常log发下：
[  642.433915@2] codec_mm:      SID(3917):      slots:1,        pages:16:       free pages:0
[  642.440037@2] codec_mm:      SID(3965):      slots:1,        pages:16:       free pages:8
[  642.446201@0] codec_mm:end dump sid hash table, total pages:5952, free:1731
[  642.454455@0] codec_mm:start dump sid hash table!
[  642.458475@0] codec_mm:end dump sid hash table, total pages:0, free:0
[  642.466300@0] codec_mm:not enough mem for amvdec_vp9 size 1376256, ret=-10003
[  642.472393@3] codec_mm:mem flags 69633 69633, 16
[  642.475798@3] amvdec_vp9 malloc failed  58
[  642.480288@3] codec:vp9_local_init: init_mv_buf_list fail
[  642.485267@3] 
[  642.485267@3] amvdec_vp9 init failed.
[  642.497505@3] codec:vdec: Decoder device ammvdec_vp9 driver probe failed.
[  642.498730@3] codec:video_port_init 642, vdec_init failed
[  642.504015@3] codec:video_port_init  failed
[  642.508268@3] codec:adec_release
[  642.514773@3] codec:Audio stbuf alloced at 00000000609e0000, secure = 0, size = 1572864
[  642.519466@3] codec:amstream_do_ioctl error :ffffffffffffffed, 401053c2
[  642.539931@2] codec:vdec_release instance ffffff800aea1000, total 2
是codec的mm不够了

20170926  9:32-20:25
1.
media.omx.isdv


20170927 9:30-20:30
1.
mi
103 ifeq ($(OS_MAJOR_VER),6)
104 $(warning Marshmallow)
105 LOCAL_CFLAGS    += -DANDROID6
106 LOCAL_CXX_STL := none
107 LOCAL_STATIC_LIBRARIES += libstlport_static
108 LOCAL_SHARED_LIBRARIES += libstdc++
109 LOCAL_C_INCLUDES += $(TOP)/external/stlport/stlport


master
122 ifeq (1, $(shell expr $(PLATFORM_VERSION) \< 6.0))
123 LOCAL_C_INCLUDES        +=$(TOP)/bionic/libstdc++/include \
124                         $(TOP)/external/stlport/stlport
125 LOCAL_STATIC_LIBRARIES += libstlport_static
126 endif
127 
128 $(warning $(LOCAL_CFLAGS))


cat /sys/module/amvideo/parameters/omx_pts
cat /sys/class/video/vframe_states

10.18.20.5:2
10.28.8.6:35

[ 1959.612909@0] fb: osd_set_free_scale_enable_hw
[ 1959.636735@0] codec:VsyncEnableVideoLayer


20170928 9:40-20:30
1.
ALOGI("stream->codec->codec_id=%d",stream->codec->codec_id);

echo 1 > /sys/module/amvdec_h265/parameters/dolby_meta_with_el
echo 3 > /sys/module/am_vecm/parameters/debug_dolby
echo 0 > /sys/module/am_vecm/parameters/debug_dolby

echo 0 > /sys/module/am_vecm/parameters/debug_dolby

cat /sys/class/amvecm/dv_mode



20170929 9:25-20:20
1.
ff_h2645_packet_split

20181009 9:30-19:40
1.
cat /sys/class/amvecm/dv_mode

stream->internal->avctx->has_dolby_vision_meta

case HEVC_NAL_SEI_DV_META:
        /*
        sample dolbyvision nal header:
        00 00 01 7C 01 19 08
        nal_type =(0x7C >> 1) 0x3f;
        */
        __android_log_print(ANDROID_LOG_ERROR, "greatgauss", "dv metadata\n");
        s->avctx->has_dolby_vision_meta = 1;
		
         if (stream->codec->codec_tag == MKTAG('d', 'v', 'h', 'e') || stream->codec->codec_tag == MKTAG('D', 'O', 'V', 'I') ) {
             mMeta->setInt32(KKeyIsDV, 1);
             ALOGI("is dobyvison\n");
+            if (stream->internal->avctx->has_dolby_vision_meta) {
+                //set property meta with el
+                property_set("media.dv.metawithel", "1");
+                ALOGI("set dv metawithel\n");
+            }

	+    //reset dv metawithel
+    property_set("media.dv.metawithel", "0");


2.
问题与148844是同一个问题，请使用下面的patch确认
http://scgit.amlogic.com:8080/29760


3.
测试code：http://firmware.myamlogic.com/shenzhen/image/android/Android-N/BOX//patchbuild/2017-10-09/q201-userdebug-64-DRM-428
测试方法：
	1.copy dovi.ko
	2.copy libOmxVideo.so
	3.打开dv开关，重启确认
	
4.

测试code：http://firmware.myamlogic.com/shenzhen/image/android/Android-N/TV//patchbuild/2017-10-09/txlx_t962x_r311-userdebug-32-DRM-410
测试方法：
	1.copy dovi.ko
	2.copy libOmxVideo.so（以上附件）
	3.打开dv开关，重启确认
note：确认时请确认下/sys/module/amvdec_h265/parameters/dolby_meta_with_el的值

20171010 9:35-19:00
1.

20171011 9:25-19:05
1.

20171012 9:25-20:40
AMSTREAM_IOC_SET_DV_METAWITHEL

pr_info("is_reset=%d\n", isreset);

         if (vdec_dual(priv->vdec) && priv->vdec->slave)
+                vdec_set_dv_metawithel(priv->vdec->slave, parm.data_32);


20171013 9:25-19:00
1.
152135 
10-13 03:33:27.213  2692  3081 D AmlogicVideoDecoderAwesome: dropped frame pts=333333, mInputTimeStampChanged=0, need_reset_omx_pts=1, frame_num=0
10-13 03:33:27.214  2692  4870 D AmlogicVideoDecoderAwesome: latency = 1033334,bufferHdr.nTimeStamp=1500000,out_pts=466666, vbuf.data_len=4795932, mFirstInputTimeStamp=0
10-13 03:33:27.234  2692  4870 D AmlogicVideoDecoderAwesome: latency = 1033334,bufferHdr.nTimeStamp=1500000,out_pts=466666, vbuf.data_len=4795932, mFirstInputTimeStamp=0

10-13 05:33:45.896  8040 17321 D NuPlayerDriver: NuPlayerDriver(0xf50b22a0) created, clientPid(3822)                                                                   
10-13 05:33:45.900  8040 17321 D SurfaceUtils: connecting to surface 0xf37cf808, reason setVideoSurfaceTexture                                                         
10-13 05:33:45.901  8040 17441 D NuPlayer: onSetVideoSurface(0xf37cf000, no video decoder)                                                                             
10-13 05:33:45.903  8040 17442 D GenericSource: FileSource remote                                                                                                      
10-13 05:33:45.904  8040 17442 W GenericSource: extractor service cannot make data source                                                                              
10-13 05:33:45.904  8040 17442 D GenericSource: FileSource local                                                                                                       
10-13 05:33:45.920  8040 17442 E GenericSource: initFromDataSource, source has no track!                                                                               
10-13 05:33:45.920  8040 17442 E GenericSource: Failed to init from data source

2
152140
10-13 04:25:18.399  2728  3056 D AmlogicVideoDecoderAwesome: dropped frame pts=434000, mInputTimeStampChanged=0, need_reset_omx_pts=1, frame_num=0
10-13 04:25:18.401  2728  4738 D AmlogicVideoDecoderAwesome: In PTS 1602000,    nFilledLen=40918, bufferHdr.pBuffer=ea317000   


3.
#define DEBUG_FLAG_WSL_DBG             0x200000

echo 0x200000 > /sys/module/amvideo/parameters/debug_flag
echo 0 > /sys/module/amvideo/parameters/debug_flag



20171015 9:44-18:36   周末加班
1.
sed -n 's/.*realtime=\(.*\), pts=.*/\1/p' 20171015_40bug_realtime.log > 40bug_realtime.log
sed -n 's/.*pts=\(.*\), toollate.*/\1/p' 20171015_40bug_realtime.log > 40bug_rpts.log
sed -n s'/.*vpts = \(.*\), c.dur.*/\1/p' 20171014_40bug_1_1.log > vpts.log
sed -n s'/.*scr = \(.*\),.*/\1/p' 20171014_40bug_1_1.log > scr.log

40bug
此处判断有误，目前sf没有设置omx_pts,只有在omx里设置，是omx的打印信息误导。通过android o与android  7.1对比发现是android原生demux出来的pts与ffmpeg 解析出来的不一致，导致checkout的pts也有问题

2. 
bug35
common/drivers/amlogic/clk/clk-mux.c:152:                       pr_info("success set parent %s rate to %lu\n"


20171016 9:25-20:40
1.
pm disable com.android.bluetooth
am start -a android.intent.action.VIEW -n com.google.android.exoplayer.demo/.PlayerActivity -d "http://10.68.11.54:8888/dump.m3u8"
am start -a com.google.android.exoplayer.demo.action.VIEW -d am start -a com.google.android.exoplayer.demo.action.VIEW -d baseline@4.0-2048x1024_Apink_MrChu_H264.mp4baseline@4.0-2048x1024_Apink_MrChu_H264.mp4 "http://10.68.11.54:8888/dump.m3u8"

am start -a com.google.android.exoplayer.demo.action.VIEW -d  file:///sdcard/Moviesmple.mp4
am start -a com.google.android.exoplayer.demo.action.VIEW -d  file:///mnt/media_rw/6CE5-9FB0/152135/baseline@4.0-2048x1024_Apink_MrChu_H264.mp4
am start -n com.android.gallery3d/.app.MovieActivity -d file:///mnt/media_rw/6CE5-9FB0/152135/baseline@4.0-2048x1024_Apink_MrChu_H264.mp4
am start -n com.android.gallery3d/.app.MovieActivity -d "http://10.68.11.54:8888/dump.m3u8"
am start -a com.google.android.exoplayer.demo.action.VIEW -d  "file:///mnt/media_rw/6CE5-9FB0/126.mp4"
am start -a com.google.android.exoplayer.demo.action.VIEW -d  file:///mnt/media_rw/6CE5-9FB0/dropframe.mp4
am start -a com.google.android.exoplayer.demo.action.VIEW -d  "file:///mnt/media_rw/6CE5-9FB0/dolby_hevc.mp4"
am start -a com.google.android.exoplayer.demo.action.VIEW -d  "file:////mnt/media_rw/6CE5-9FB0/dropframe.mp4"



20171017 9:20-
1.
find . -type f -exec touch {} \; 再mm -B
 所有omx so 时间都会更新
你到out 目录的system lib 目录

SH-徐金涛 2017/9/25 10:24:41
按时间排序 你看一下

commit f515a77ff2ecc71aaca098f19ff1839ffe2f54b8
Author: shuanglong.wang <shuanglong.wang@amlogic.com>
Date:   Thu Oct 12 20:35:35 2017 +0800

    omx : set dolby_meta_with_el when reset [1/1]
    
    PD# 148069
    
    set dolby_meta_with_el when decoder reset again.
    
    Change-Id: Ib73baf85d296b2a7bb6888abf6ce33a0387d7540
	
	
20171018 9:20- 122:10	
	logc > 20171018_N_bug40_30fps_omx.log &
	logc > 20171018_N_bug40_29.97fps_omx.log &
	logc > 20171018_N_bug40_59.94fps_omx.log &

getmivcipts 20171018_N_bug40_59.94fps_omx.log
getmivcopts 20171018_N_bug40_59.94fps_omx.log
getmivcipts 20171018_O_bug40_59.94fps_omx.log
getmivcopts 20171018_O_bug40_59.94fps_omx.log 


sed -n 's/.*realtime=\(.*\), pts=.*/\1/p' 20171018_O_bug40_59.94fps_omx.log > O_40bug_59.94fps_realtime.log
sed -n 's/.*pts=\(.*\), toollate.*/\1/p' 20171018_O_bug40_59.94fps_omx.log > O_40bug_59.94fps_rpts.log
sed -n 's/.*realtime=\(.*\), pts=.*/\1/p' 20171018_N_bug40_59.94fps_omx.log > N_40bug_59.94fps_realtime.log
sed -n 's/.*pts=\(.*\), toollate.*/\1/p' 20171018_N_bug40_59.94fps_omx.log > N_40bug_59.94fps_rpts.log



sed -n s'/.*vpts = \(.*\), c.dur.*/\1/p' 20171017_O_bug40_59.94fps_kernel.log > O_bug40_59.94fps_vpts.log
sed -n s'/.*scr = \(.*\),.*/\1/p' 20171017_O_bug40_59.94fps_kernel.log > O_bug40_59.94fps_scr.log
sed -n s'/.*vpts = \(.*\), c.dur.*/\1/p' 20171017_N_bug40_59.94fps_kernel.log > N_bug40_59.94fps_vpts.log
sed -n s'/.*scr = \(.*\),.*/\1/p' 20171017_N_bug40_59.94fps_kernel.log > N_bug40_59.94fps_scr.log

sed -n 's/.*realtime=\(.*\), pts=.*/\1/p' 20171018_O_bug40_vp9modify_29.97fps_omx.log > O_40bug_vp9modify_29.97fps_realtime.log
sed -n 's/.*pts=\(.*\), toollate.*/\1/p' 20171018_O_bug40_vp9modify_29.97fps_omx.log > O_40bug_vp9_modify_29.97fps_rpts.log


20181019 9:10-
1.暂时修改解决vp8卡住的问题

2.29.97，kernel修改 pts_unstable和pbi->vvp9_amstream_dec_info.rate = 3203；确认问题

3.
hi，nanxin, 3.14有个提交，http://scgit.amlogic.com:8080/#/c/31252/，你看这个有影响没？ @SZ-南鑫 

cat /sys/module/amvdec_mh264/parameters/fast_output_enable
echo 4 > /sys/module/amvdec_mh264/parameters/fast_output_enable
echo 0 > /sys/module/amvdec_mh264/parameters/fast_output_enable

20171020 9:10-

1.
sed -n 's/10-20 \(.*\) 2606.*/\1/p' test.log
echo "01:29:37.352" |cut -d: -f1
echo "01:29:37.352" |cut -d: -f1
echo "01:29:37.352" |cut -d: -f1

2.
Bug 140486 - [天和海博-S905X-客户反馈-Online]：直播VMX码流低概率出现library崩溃的现象

20171022 10:10-
1.
error: unpack failed: error Missing tree 361dd2cca6210c6b5143f5cdf265da3cecef82db
fatal: Unpack error, check server log
To ssh://shuanglong.wang@scgit.amlogic.com:29418/platform/external/ffmpeg
 ! [remote rejected] n-amlogic -> refs/for/n-amlogic (n/a (unpacker error))
error: failed to push some refs to 'ssh://shuanglong.wang@scgit.amlogic.com:29418/platform/external/ffmpeg

双层 DOVI El
[  728.352054@0] DOLBY: frame 0 pts 0, src bdp: 10 format: DOVI (el meta), aux_size:1320, enhance: 1
双层 DOVI BL
[  901.552095@0] DOLBY: frame 0 pts 0, src bdp: 12 format: DOVI, aux_size:1320, enhance: 1
单层DOVI
[  493.352424@0] DOLBY: frame 0 pts 0, src bdp: 12 format: DOVI, aux_size:1488, enhance: 0
HDR
[ 1060.818963@0] DOLBY: frame 0 pts 0, src bdp: 10 format: HDR10, aux_size:0, enhance: 0
SDR
[ 1098.084669@0] DOLBY: frame 0 pts 0, src bdp: 10 format: SDR, aux_size:0, enhance: 0


AV_CODEC_ID_HEVC, MKTAG('d', 'v', 'h', 'e')
MKTAG('d', 'v', 'h', 'e'), AVMEDIA_TYPE_VIDEO , AV_CODEC_ID_HEVC}

2.
f515a77ff2ecc71aaca098f19ff1839ffe2f54b8
546b4fd18e2533226a5083634efc080757910afb
40be18d4f7b2fadc7e94238b57a3f091e16cc5db
9bf478e08f1412473c9d046e6e72e3e469fdd7c3

int mFormatterESLenCheckCount;


-666667
-333333
6666667
1666666

echo -3800 > /sys/module/amvideo/parameters/omx_pts_interval_lower
echo 2000 > /sys/module/amvideo/parameters/omx_pts_interval_upper


14826858

14843089 pts

14830218

14832340


20171-25 9:20-10:30
1.
echo 0x200000 > /sys/module/amvideo/parameters/debug_flag
echo 0 > /sys/module/amvideo/parameters/debug_flag
echo 0x800000 > /sys/module/amvideo/parameters/debug_flag
cat /sys/class/vfm/map


8.0平台，我确认下720P的，OSD层显示的，起播的时候，有些视频也是会有卡顿的
OSD显示 "setprop media.omx.display_mode 0"
Video显示“setprop media.omx.display_mode 1”
1.请确认下O上ftp上视频的播放情况是与我描述的一致
2.请确认下其它平台上的上述视频的播放情况

http://10.68.11.54:8000/HLS/rabbit/rabbit.m3u8
mount -o remount,rw /vendor

20171026 9:23-
1.
http://scgit.amlogic.com:8080/32441
http://scgit.amlogic.com:8080/32278


extractAndQueueAccessUnits

mount -o remount,rw /vendor
 
 
 [10.28 01:59:26]:01-01 06:06:39.935 D/AmlogicVideoDecoderAwesome( 5063): checkout pts___!!_mLastTimeStamp=101400, mPtsRecoveryCount=0
 
 
cd /share/aspera
aspera服务器

am start -a com.google.android.exoplayer.demo.action.VIEW -d http://10.68.11.62:8800/rmdmy1/index.m3u8

cat /sys/module/ionvideo/parameters/debug
echo 4 > /sys/module/ionvideo/parameters/debug
echo 0 > /sys/module/ionvideo/parameters/debug


20171103 9:10-
四个文件，我们播放解码对比：
  我们家的电视播放结果：
      Transition_Test_dvhe.dtr_to_HDR10_UHD_23976.ts（必现画面卡住）
    Transition_Test_dvhe.dtr_to_SDR_UHD_23976.ts（概率出现画面卡住）
    Transition_Test_dvhe.stn_to_HDR10_UHD_23976.ts（概率出现画面卡住）
    Transition_Test_dvhe.stn_to_SDR_UHD_23976.ts（超高概率出现画面卡住）

  第三方播放解码结果：
    Transition_Test_dvhe.dtr_to_HDR10_UHD_23976.ts（Mstar938 SDR模式可正常解码播放，LG电视播放画面也会卡死）
    Transition_Test_dvhe.dtr_to_SDR_UHD_23976.ts（Mstar938 SDR模式可以正常解码播放，LG电视播放画面也会卡死）
    Transition_Test_dvhe.stn_to_HDR10_UHD_23976.ts（Mstar938 SDR模式提示不支持，LG电视播放画面也会卡死）
    Transition_Test_dvhe.stn_to_SDR_UHD_23976.ts（Mstar938 SDR模式提示不支持，LG电视可以正常播放且有DV效果）
	
	



20171104 10:23
1.
cat /sys/class/vfm/map
echo dump vdec.h265.00 > /sys/class/vfm/map
echo dump amlvideo > /sys/class/vfm/map
echo dump deinterlace > /sys/class/vfm/map
cat /sys/class/deinterlace/di0/provider_vframe_status

echo 0x800000 > /sys/module/amvideo/parameters/debug_flag
echo 0 > /sys/module/amvideo/parameters/debug_flag

echo 0x800 > /sys/module/amvdec_h265/parameters/debug_mask

DEBUG_FLAG_TOGGLE_FRAME_PER_VSYNC
echo 0x20000 > /sys/module/amvideo/parameters/debug_flag

echo 2 > /sys/module/amvideo/parameters/debug_flag

echo 1 > /sys/class/video/slowsync_repeat_enable

897145

vpts_expire(cur_dispbuf, vf)
pr_info("vfpts=%d@%p pcr=%d\n", vf->pts, vf, timestamp_vpts_get());

[  124.728404@0] codec:vfpts=893391@ffffff8005fec410 pcr=889638
[  124.728441@0] codec:vfpts=897145@ffffff8005fed090 pcr=893391
[  124.745079@0] codec:vfpts=897145@ffffff8005fed090 pcr=893391
[  124.761738@0] codec:vfpts=897145@ffffff8005fed090 pcr=893391
[  124.761774@0] codec:vfpts=0@ffffff8005fed3b0 pcr=897145
[  124.778414@0] codec:vfpts=0@ffffff8005fed3b0 pcr=897145
[  124.795074@0] codec:vfpts=0@ffffff8005fed3b0 pcr=897145


[  564.535738@0] codec:vfpts=897145@ffffff8000ade090 pcr=893391
[  564.548154@0] codec:vfpts=897145@ffffff8000ade090 pcr=893391
[  564.563146@0] codec:vfpts=897145@ffffff8000ade090 pcr=893391
[  564.596444@0] codec:vfpts=0@ffffff8000ade3b0 pcr=897145
[  564.622592@0] codec:vfpts=3753@ffffff8000ade6d0 pcr=900899
[  564.662934@0] codec:vfpts=7506@ffffff8000ade9f0 pcr=3753


KKeyStreamTimeToUsRatio = 'sttu', // int32_t

98f12f96

20171106-
http://scgit.amlogic.com:8080/#/c/33115/，这个patch @SH-泡泡


  if(mAudioTimeJump && !mVideoTimeJump) {
        int64_t VideoTimeUs;
        buffer->meta()->findInt64("timeUs", &VideoTimeUs);
        if ((VideoTimeUs - mLastAudioUs) > 3000000) {
            entry.mNotifyConsumed->post();
            ALOGV("audio jump, drop some large pts video, diff=%lld\n", VideoTimeUs - mLastAudioUs);
            return;
        }
    }

20171108

http://10.68.11.62:8800/jzkys1/index.m3u8


20171113 9:08-
echo 11000  > /sys/module/amvideo/parameters/omx_pts_interval_upper
echo -5500  > /sys/module/amvideo/parameters/omx_pts_interval_lower

echo 4000  > /sys/module/amvideo/parameters/omx_pts_interval_upper
echo -2000  > /sys/module/amvideo/parameters/omx_pts_interval_lower


root@HRA920_512_ALI2G:/ # cat /sys/class/vfm/map
default_amlvideo2 { vdin1(0) amlvideo2.1}
default { decoder(1) amlvideo(1) deinterlace(1) amvideo}

echo 3 > /sys/module/aml_vfm/parameters/vfm_trace_enable
echo 100 > /sys/module/aml_vfm/parameters/vfm_trace_num
echo dump deinterlace > /sys/class/vfm/map
echo 0 > /proc/sys/kernel/printk
dmesg > vfmtrace.log





echo 3 > /sys/module/aml_vfm/parameters/vfm_trace_enable
echo 100 > /sys/module/aml_vfm/parameters/vfm_trace_num
echo 0 > /proc/sys/kernel/printk
setprop media.hls.ptsdebug 4


echo dump deinterlace > /sys/class/vfm/map && dmesg > vfmtrace.log
echo 0x400000 > /sys/module/amvideo/parameters/debug_flag
logcat -c && logcat > stunck.log &

echo 0x20000 > /sys/module/amvideo/parameters/debug_flag

am start -n com.android.gallery3d/com.android.gallery3d.app.MovieActivity http://10.28.8.22/Chromecast_opportunity/new/4KVP9/[4Kvp9_60.000fps_12.6Mbps]Wetek-Astra-2m.webm 

am start -n com.android.gallery3d/com.android.gallery3d.app.MovieActivity http://10.28.8.22/Chromecast_opportunity/new/h265/%5b4KH265_60.000fps_9Mbps%5dWetek-Astra-2m.mp4

am start -a com.google.android.exoplayer.demo.action.VIEW -d http://10.28.8.22/Chromecast_opportunity/new/4KVP9/[4Kvp9_60.000fps_12.6Mbps]Wetek-Astra-2m.webm 
am start -a com.google.android.exoplayer.demo.action.VIEW -d http://10.28.8.22/Chromecast_opportunity/new/h265/%5b4KH265_60.000fps_9Mbps%5dWetek-Astra-2m.mp4

//wsl debug
echo 0x400000 > /sys/module/amvideo/parameters/debug_flag


20161116
am start -n com.android.gallery3d/com.android.gallery3d.app.MovieActivity http://10.18.11.251/tv_qatest/chromecast_hw_test/other/%5b4KH264_30.000fps_15.2Mbps%5dWetek-Astra-2m.mp4


219
queueBuffer: error queuing buffer to SurfaceTexture, -19

220
14742468 01-04 00:05:03.674 D/SurfaceFlinger( 2588): Backpressure trigger, skipping transaction & refresh!
Failed to find layer (Background for - SurfaceView - com.droidlogic.videoplayer/com.droidlogic.videoplayer.VideoPl
         ayer#0) in layer parent (no-parent).
14742509 01-04 00:05:04.445 W/InputDispatcher( 2772): channel 'ce8c8f9 com.droidlogic.videoplayer/com.droidlogic.videoplayer.VideoPlayer (server)' ~ Consumer closed in
         put channel or an error occurred.  events=0x9
14742510 01-04 00:05:04.445 E/InputDispatcher( 2772): channel 'ce8c8f9 com.droidlogic.videoplayer/com.droidlogic.videoplayer.VideoPlayer (server)' ~ Channel is unrecov
         erably broken and will be disposed!

		 
am start -n com.android.gallery3d/com.android.gallery3d.app.MovieActivity http://10.68.11.62:8800/vp9/[4KVP9_60.000fps_15.5Mbps]Wetek-Astra-2m.webm
		
http://10.68.11.62:8800/20171121-tmp/index.m3u8


setprop media.hls.ptsdebug 4
setprop media.hls.read_pts 1


echo 0x400000 > /sys/module/amvideo/parameters/debug_flag


上周
1.解决联想“大码率mp4视频seek到最后几秒时再退出现not respond”和“个别流resume播放同由于extradata数据的configurationVersion问题不传csd数据导致的黑屏”的问题
2.处理“斐讯项目爱爱奇艺网络轮播（武林外传等）2-3小时出现av不同步的问题”，定位到是音频的输出的问题，已让lianlian分析
3.处理dv个别双层流el层没有传csd的问题，在amgenericsource中readbuffer中处理，patch已给rain，本地没有还没有上传
4.分析“Bug 154692 - {AV} Android 8.0 播放http 4KH264和4KH265显示第一帧后视频卡住的问题”，nuplayer处理缓冲有bug，bugzilla已更新

本周：
处理公版android O的问题
cp libdatachunkqueue_alt.so  libomx_av_core_alt.so libomx_clock_utils_alt.so libomx_framework_alt.so libOmxVideo.so libstagefrighthw.so libfpscalculator_alt.so libOmxBase.so libOmxCore.so libomx_timed_task_queue_alt.so libomx_worker_peer_alt.so libthreadworker_alt.so



为确认是否是所有265 24fps都有丢帧率的问题
刚才我看了其它的24fps的h265视频，其它看着还好
8bit
4KH265_24.000fps_20.0Mbps_8bit]tearsofsteel.mp4
[4KH265_24.000fps_34.5Mbps_8bit]uhd3d-supershopdemo_6.mp4
[4KH265_24.000fps_36.1Mbps_8bit]uhd3d-supershopdemo_2.mp4
[4KH265_24.000fps_36.1Mbps_8bit]uhd3d-supershopdemo_4.mp4		

10bit
[4KH265_24.000fps_38.4Mbps_10bit]uhd3d-Philips_UHD_supershopdemo_1.mp4
[4KH265_24.000fps_38.5Mbps_10bit]uhd3d-Philips_Ultra-HD_Beach_Life_supershop-demo-3.mp4
[4KH265_24.000fps_45.1Mbps_10bit]uhd3d-Life_of_Pi_draft_Ultra-HD_HDR.mp4


打印surfacefinger的显示时间
dumpsys SurfaceFlinger --latency "SurfaceView - com.android.gallery3d/com.android.gallery3d.app.MovieActivity"
dumpsys SurfaceFlinger --latency "com.droidlogic.videoplayer/com.droidlogic.videoplayer.VideoPlayer"

android O
dumpsys SurfaceFlinger --latency "com.droidlogic.videoplayer/com.droidlogic.videoplayer.VideoPlayer#0"



20171204 9:10-
1.
2路1080p 264卡住的原因
4路720p卡住

上周：
1.解决3pg文件煲机里出现的crash，数组越界访问
2.24fps跳帧问题分析，其中ftp传的1080p视频开机向秒应是surfaceflinger显示问题，今日dailiang反馈的一个4k视频正在本地复现
3.anroid O上多路部分多路分析

本周：
1.配合联想项目debug
2.继续清理公版bug


am start -n com.android.gallery3d/com.android.gallery3d.app.MovieActivity http://10.68.11.62:8800/vp9/[4KVP9_60.000fps_15.5Mbps]Wetek-Astra-2m.webm
am start -a com.google.android.exoplayer.demo.action.VIEW -d http://10.68.11.62:8800/vp9/[4KVP9_60.000fps_15.5Mbps]Wetek-Astra-2m.webm

setprop media.stagefright.cache-params "71680/1024000/15"

wsl 3785 9463,15505487


am start -n com.android.gallery3d/com.android.gallery3d.app.MovieActivity http://10.18.11.251/tv_qatest/chromecast_hw_test/other/%5b4KH264_30.000fps_15.2Mbps%5dWetek-Astra-2m.mp4
am start -a com.google.android.exoplayer.demo.action.VIEW -d http://10.18.11.251/tv_qatest/chromecast_hw_test/other/%5b4KH264_30.000fps_15.2Mbps%5dWetek-Astra-2m.mp4
am start -n com.android.gallery3d/com.android.gallery3d.app.MovieActivity http://10.18.11.251/tv_qatest/chromecast_hw_test/other/265/8bit_4kh265/%5b4KH265_60.000fps_22.9Mbps%5dWetek-Astra-2m.mp4
am start -a com.google.android.exoplayer.demo.action.VIEW -d http://10.18.11.251/tv_qatest/chromecast_hw_test/other/265/8bit_4kh265/%5b4KH265_60.000fps_22.9Mbps%5dWetek-Astra-2m.mp4



am start -n com.android.gallery3d/com.android.gallery3d.app.MovieActivity http://10.18.11.251/tv_qatest/chromecast_hw_test/other/vp9/%5b4KVP9_60.000fps_15.5Mbps%5dWetek-Astra-2m.webm
am start -a com.google.android.exoplayer.demo.action.VIEW -d  http://10.18.11.251/tv_qatest/chromecast_hw_test/other/vp9/%5b4KVP9_60.000fps_15.5Mbps%5dWetek-Astra-2m.webm


Bug 154690 - {AV} Android 8.0 播放HTTP 4KVP9视频流，画面卡顿，不流畅
Bug 154692 - {AV} Android 8.0 播放http 4KH264和4KH265显示第一帧后视频卡住，无声


20171207
2路1080p 264，目前不会卡住，aac->ac3 没有音频

使用小电视+圆板卡
2路1080p h264 		1次
4路720p h264 		3次
3路720p h264 + 1路720p h265 	3次
6路480p h264 		2次

使用小电视+方板卡
4路720p h264 		2次
6路480p h264 		2次



使用大电视+圆板卡
4路720p h264 		2次
6路480p h264 		2次


logcat -s AmlogicVideoDecoderAwesome GenericSource NuPlayerRenderer


20171211
1.
Bug 156349 - {AV} [Full treble] S805X 8.0 播放VP8视频2、3秒后画面卡住，声音正常,    ===》没有传视频
Bug 156268 - {KODI}[full treble]KODI播放部分VP9视频文件，画面卡顿            ===》没有视频[1080VP9_59.94fps_4477Kbps_8bit]youtube-[LG_UHD_59.94FPS] AOA - Miniskirt.webm
Bug 156197 - {KODI}[full treble] P241操作KODI播放00001.m2ts视频时，按遥控器左右键进行反复快进退操作，出现画面卡住，串口不能输入  =》没有视频00001.m2ts
Bug 155080 - {SPMC}播放Seabiscuit.1080P.wmv视频文件，音画不同步，出现马赛克    ===》没有视频Seabiscuit.1080P.wmv


上周
1）解决联想项目个别视频循环播放时seek到末尾不能再次重新播放的问题
2）O确认公版24fps h265跳帧的问题
3）O确认公版http 4k vp9,h265,h264播放卡住的问题
4）O确认公版多路解码卡顿的问题

本周
确认公版上Full terble的问题



cat /proc/irq/158/smp_affinity
echo e > /proc/irq/158/smp_affinity


setprop media.omx.log_levels 255
echo 0x400000 > /sys/module/amvideo/parameters/debug_flag

下面的两个需要降下级
Bug 156349 - {AV} [Full treble] S805X 8.0 播放VP8视频2、3秒后画面卡住，声音正常
Bug 155080 - {SPMC}播放Seabiscuit.1080P.wmv视频文件，音画不同步，出现马赛克

下面这个需要显示的分析
Bug 156268 - {KODI}[full treble]KODI播放部分VP9视频文件，画面卡顿 


setprop media.omx.log_levels 255
echo 0x400000 > /sys/module/amvideo/parameters/debug_flag

/sys/module/amvideo/parameters/video_dbg_vf

http://scgit.amlogic.com:8080/#/c/35269/

echo 1 > /sys/module/amvideo/parameters/freerun_mode




Tasks: 217 total,   3 running, 212 sleeping,   0 stopped,   2 zombie                                                                                                   
Mem:   1008960k total,   974648k used,    34312k free,    10736k buffers                                                                                               
Swap:   511996k total,     2228k used,   509768k free,   399416k cached                                                                                                
400%cpu 179%user   8%nice 146%sys  67%idle   0%iow   0%irq   1%sirq   0%host                                                                                           
  PID USER         PR  NI VIRT  RES  SHR S[%CPU] %MEM     TIME+ ARGS                                                                                                   
 5717 u0_a46       10 -10 1.5G 152M 104M S  143  15.4   3:53.88 org.xbmc.kodi
 2723 system       -2  -8  77M  12M 9.4M S 60.6   1.2   8:49.15 surfaceflinger
 2767 mediacodec   20   0  61M  14M  10M S 37.3   1.3   1:58.27 media.codec hw/android.hardware.media.omx@1.0-service
 2919 system       18  -2 1.3G 136M 115M S 27.0  13.7   2:45.38 system_server
 2711 system       -3  -8  62M 6.9M 5.6M S 14.0   0.7   2:10.26 android.hardware.graphics.composer@2.1-service
 5888 root         20   0 5.7M 3.0M 2.3M R 11.0   0.3   0:06.29 top
 2703 audioserver  20   0  25M 7.8M 6.6M S 10.0   0.7   0:47.31 android.hardware.audio@2.0-service
 2740 audioserver  20   0  42M  14M  11M S  8.3   1.4   0:42.00 audioserve
 
 
/sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq                         <
1200000
p241:/data/test/20171213 # cat /sys/devices/system/cpu/cpu1/cpufreq/scaling_cu>
1200000
/sys/devices/system/cpu/cpu3/cpufreq/scaling_cur_freq                         <
1200000
/sys/devices/system/cpu/cpu2/cpufreq/scaling_cur_freq                         <
1200000


setprop media.omx.log_levels 255

cat /proc/irq/76/smp_affinity
cat /proc/interrupts
echo 0x20000 > /sys/module/amvideo/parameters/debug_flag
cat /sys/module/amvideo/parameters/underflow


decoder(1) amlvideo(1) deinterlace(1) amvideo

echo rm default > /sys/class/vfm/map
echo add default decoder amlvideo deinterlace amvideo > /sys/class/vfm/map
echo rm default > /sys/class/vfm/map
echo add default decoder amlvideo amvideo > /sys/class/vfm/map
chmod 444 /sys/class/vfm/map
echo add default decoder amvideo > /sys/class/vfm/map

cat /sys/module/amvideo/parameters/underflow
cat /sys/class/video/freerun_mode
echo 1 > /sys/class/video/freerun_mode

echo 1 > /sys/class/tsync/debug_pts_checkout && echo 1 > /sys/class/tsync/debug_video_pts && echo 0 > /proc/sys/kernel/printk && dmesg > kernel.log

echo 0x2 > /sys/module/amvideo/parameters/video_dbg_vf
echo 0x32 > /sys/module/amvideo/parameters/video_dbg_vf
echo 0x30 > /sys/module/amvideo/parameters/video_dbg_vf
echo 0 > /sys/module/amvideo/parameters/video_dbg_vf
echo 0x10 > /sys/module/amvideo/parameters/video_dbg_vf
echo 0x20 > /sys/module/amvideo/parameters/video_dbg_vf


echo dump decoder > /sys/class/vfm/map && echo dump amlvideo > /sys/class/vfm/map && echo dump deinterlace > /sys/class/vfm/map

static int omx_pts_interval_upper = 11000;
static int omx_pts_interval_lower = -5500;

echo 5000 > /sys/module/amvideo/parameters/omx_pts_interval_upper
echo -2000 > /sys/module/amvideo/parameters/omx_pts_interval_lower

cat /sys/class/video/vsync_slow_factor 


echo 0x30 > /sys/module/amvideo/parameters/video_dbg_vf
echo 0x400000 > /sys/module/amvideo/parameters/debug_flag


cat /sys/module/amvideo/parameters/omx_pts &&
cat /sys/class/tsync/pts_pcrscr

echo 0x2 > /sys/module/amvideo/parameters/debug_flag



35	[   56.005224@0] codec:<0x689c9:0x7bc78>, look_cnt = 2
94  [   56.995212@0] codec:<0x7a341:0x9162c>, look_cnt = 3

95	[   57.005264@0] codec:<0x7aa15:0x91c08>, look_cnt = 2
154	[   57.995193@0] codec:<0x90cef:0xa75bc>, look_cnt = 3

155	[   58.005312@0] codec:<0x913c5:0xa7b98>, look_cnt = 2
214	[   58.985453@0] codec:<0xa229e:0xbd54c>, look_cnt = 3

215	[   59.005468@0] codec:<0xa263e:0xbdb28>, look_cnt = 2
274	[   59.995426@0] codec:<0xb07f4:0xd34dc>, look_cnt = 3

275	[   60.005530@0] codec:<0xb0b94:0xd3ab8>, look_cnt = 2
334	[   60.995288@0] codec:<0xbeb13:0xe946c>, look_cnt = 3
336	[   61.005242@0] codec:<0xbf33c:0xea024>, look_cnt = 2

335	[   61.005206@0] codec:<0xbeeb3:0xe9a48>, look_cnt = 2
396	[   62.005179@0] codec:<0xc8ec5:0xfffb4>, look_cnt = 2

395	[   62.005143@0] codec:<0xc8ab7:0xff9d8>, look_cnt = 2
454	[   62.985318@0] codec:<0xd65a4:0x11538c>, look_cnt = 3

455	[   63.005200@0] codec:<0xd68fb:0x115968>, look_cnt = 2
514	[   63.985076@0] codec:<0xe43df:0x12b31c>, look_cnt = 3

515	[   64.005203@0] codec:<0xe4721:0x12b8f8>, look_cnt = 2
574	[   64.985122@0] codec:<0xee528:0x1412ac>, look_cnt = 3

1）vfm数据链路 default { decoder(1) amlvideo(1) deinterlace(1) amvideo}
1080p@60fps，h264视频，正常情况下，1个vsync显示1个frame，目前video显示peek时出现underflow，一直在增加，
underflow时打印vfm链路的buffer情况，amlvideo的avaiable为0，decoder数据足够
vfm中去掉di，underflow继续有，排除di的影响
echo 0x32 > /sys/module/amvideo/parameters/video_dbg_vf
[  176.635669@0] codec:decoder_pool_size=64
[  176.635674@0] codec:decoder buf_free_num=59
[  176.635678@0] codec:decoder buf_avail_num=4
[  176.768821@0] codec:deinterlace_pool_size=10
[  176.768837@0] codec:deinterlace buf_free_num=4
[  176.768841@0] codec:deinterlace buf_avail_num=0
[  176.768848@0] codec:amlvideo_pool_size=16
[  176.768852@0] codec:amlvideo buf_free_num=16
[  176.768856@0] codec:amlvideo buf_avail_num=0
[  176.768863@0] codec:decoder_pool_size=64
[  176.768867@0] codec:decoder buf_free_num=58
[  176.768871@0] codec:decoder buf_avail_num=5
[  176.802394@0] codec:deinterlace_pool_size=10
[  176.802429@0] codec:deinterlace buf_free_num=4
[  176.802434@0] codec:deinterlace buf_avail_num=0
[  176.802440@0] codec:amlvideo_pool_size=16
[  176.802445@0] codec:amlvideo buf_free_num=16
[  176.802449@0] codec:amlvideo buf_avail_num=0
[  176.802468@0] codec:decoder_pool_size=64
[  176.802472@0] codec:decoder buf_free_num=58
[  176.802478@0] codec:decoder buf_avail_num=5
[  176.835716@0] codec:deinterlace_pool_size=10
[  176.835758@0] codec:deinterlace buf_free_num=4
[  176.835762@0] codec:deinterlace buf_avail_num=0

2）设置echo 0x20000 > /sys/module/amvideo/parameres/debug_flag，DEBUG_FLAG_TOGGLE_FRAME_PER_VSYNC，这个debug一打开，underflow也会没有了
这个因为显示不均匀导致的，设置上DEBUG_FLAG_TOGGLE_FRAME_PER_VSYNC会一个vsync只会显示一个frame，而不去再判断pcr与pts差值去显示
scr		diff	pts		diff
675001	1500	675001	1500
676501	1500	676501	1500
685501	9000	678001	1500
685501	0		679501	1500
688501	3000	681001	1500
690001	1500	682501	1500
690001	0		684001	1500
691501	1500	685501	1500
693001	1500	687001	1500
694501	1500	688501	1500
696001	1500	690001	1500
697501	1500	691501	1500
697501	0		693001	1500
699001	1500	694501	1500
700501	1500	696001	1500
702001	1500	697501	1500
703501	1500	699001	1500
706501	3000	700501	1500
708001	1500	702001	1500
709501	1500	703501	1500

3）omx log分析outpts正常，输出很均匀，上层没有丢帧
4）mi player和movie player都有underflow的问题，但movie player播放器上层不同步的问题
5）vsync时钟正常，没有出现漂
4）video显示同步分析
4.1）去掉audio，没有underflow；
4.2）减少omxpts调整pcr的阈值，没有underflow
echo 5000 > /sys/module/amvideo/parameters/omx_pts_interval_upper
echo -2000 > /sys/module/amvideo/parameters/omx_pts_interval_lower

分析以上，同步是有些问题，但不确定一定是同步引起



20171218
1.
echo rm default > /sys/class/vfm/map
echo add default decoder  deinterlace amvideo > /sys/class/vfm/map
echo add default decoder  amlvideo deinterlace amvideo > /sys/class/vfm/map
chmod 444 /sys/class/vfm/map
[00]  default { decoder(1) ppmgr(1) deinterlace(1) amvideo}

后
p212:/ # cat /sys/class/codec_mm/codec_mm_dump                                 
codec mem info:
        total codec mem size:401 MB
        alloced size= 41 MB
        max alloced: 41 MB
        CMA:0,RES:41,TVP:0,SYS:0 MB
        [3]RES size:65 MB,alloced:41 MB free:23 MB
        [4]CMA size:336 MB:alloced: 0 MB,free:336 MB
        [1].0:ammvdec_h264.65,addr=000000005ab00000,size=2097152,from=3,cnt=1,flags=69633,used:622 ms
        [2].0:VFRAME_INPUT.0,addr=000000005ad00000,size=524288,from=3,cnt=1,flags=4099,used:622 ms
        [3].0:VFRAME_INPUT.0,addr=000000005ad80000,size=524288,from=3,cnt=1,flags=4099,used:622 ms
        [4].0:VFRAME_INPUT.0,addr=000000005ae00000,size=524288,from=3,cnt=1,flags=4099,used:622 ms
        [5].0:ammvdec_h264.0,addr=000000005ae80000,size=3145728,from=3,cnt=1,flags=69633,used:618 ms
        [6].0:ammvdec_h264.64,addr=000000005b180000,size=5505024,from=3,cnt=1,flags=69633,used:618 ms
        [7].0:ammvdec_h264.1,addr=000000005b6c0000,size=3145728,from=3,cnt=1,flags=69633,used:618 ms
        [8].0:ammvdec_h264.2,addr=000000005b9c0000,size=3145728,from=3,cnt=1,flags=69633,used:618 ms
        [9].0:ammvdec_h264.3,addr=000000005bcc0000,size=3145728,from=3,cnt=1,flags=69633,used:618 ms
        [10].0:ammvdec_h264.4,addr=000000005bfc0000,size=3145728,from=3,cnt=1,flags=69633,used:618 ms
        [11].0:ammvdec_h264.5,addr=000000005c2c0000,size=3145728,from=3,cnt=1,flags=69633,used:618 ms
        [12].0:ammvdec_h264.6,addr=000000005c5c0000,size=3145728,from=3,cnt=1,flags=69633,used:618 ms
        [13].0:ammvdec_h264.7,addr=000000005c8c0000,size=3145728,from=3,cnt=1,flags=69633,used:618 ms
        [14].0:ammvdec_h264.8,addr=000000005cbc0000,size=3145728,from=3,cnt=1,flags=69633,used:618 ms
        [15].0:ammvdec_h264.9,addr=000000005cec0000,size=3145728,from=3,cnt=1,flags=69633,used:618 ms
        [16].0:ammvdec_h264.10,addr=000000005d1c0000,size=3145728,from=3,cnt=1,flags=69633,used:618 ms

 cat /sys/class/codec_mm/codec_mm_dump                                 
codec mem info:
        total codec mem size:401 MB
        alloced size= 41 MB
        max alloced: 41 MB
        CMA:0,RES:41,TVP:0,SYS:0 MB
        [3]RES size:65 MB,alloced:41 MB free:23 MB
        [4]CMA size:336 MB:alloced: 0 MB,free:336 MB
        [49].0:ammvdec_h264.65,addr=000000005ab00000,size=2097152,from=3,cnt=1,flags=69633,used:197 ms
        [50].0:VFRAME_INPUT.0,addr=000000005ad00000,size=524288,from=3,cnt=1,flags=4099,used:196 ms
        [51].0:VFRAME_INPUT.0,addr=000000005ad80000,size=524288,from=3,cnt=1,flags=4099,used:196 ms
        [52].0:VFRAME_INPUT.0,addr=000000005ae00000,size=524288,from=3,cnt=1,flags=4099,used:196 ms
        [53].0:ammvdec_h264.0,addr=000000005ae80000,size=3145728,from=3,cnt=1,flags=69633,used:193 ms
        [54].0:ammvdec_h264.64,addr=000000005b180000,size=5505024,from=3,cnt=1,flags=69633,used:193 ms
        [55].0:ammvdec_h264.1,addr=000000005b6c0000,size=3145728,from=3,cnt=1,flags=69633,used:193 ms
        [56].0:ammvdec_h264.2,addr=000000005b9c0000,size=3145728,from=3,cnt=1,flags=69633,used:193 ms
        [57].0:ammvdec_h264.3,addr=000000005bcc0000,size=3145728,from=3,cnt=1,flags=69633,used:193 ms
        [58].0:ammvdec_h264.4,addr=000000005bfc0000,size=3145728,from=3,cnt=1,flags=69633,used:193 ms
        [59].0:ammvdec_h264.5,addr=000000005c2c0000,size=3145728,from=3,cnt=1,flags=69633,used:193 ms
        [60].0:ammvdec_h264.6,addr=000000005c5c0000,size=3145728,from=3,cnt=1,flags=69633,used:193 ms
        [61].0:ammvdec_h264.7,addr=000000005c8c0000,size=3145728,from=3,cnt=1,flags=69633,used:193 ms
        [62].0:ammvdec_h264.8,addr=000000005cbc0000,size=3145728,from=3,cnt=1,flags=69633,used:193 ms
        [63].0:ammvdec_h264.9,addr=000000005cec0000,size=3145728,from=3,cnt=1,flags=69633,used:193 ms
        [64].0:ammvdec_h264.10,addr=000000005d1c0000,size=3145728,from=3,cnt=1,flags=69633,used:193 ms

上周：
1.确认full treble vp8卡住、Seabiscuit.1080P.wmv视频文件，音画不同步的问题，已降级；
2.确认[Full terble]netflix播放H265格式视频音画不同步的问题，音频的权限的问题，音频RD已处理；
3.4KVP9煲机退到home界面，原生android crash，已提供patch；
4.p241平台full treble KODI播放部分VP9视频文件，画面卡顿，目前分析到kodi osd显示时cpu占用过高；
5.小米本地播放dropframe.mp4片源严重掉帧，减小omxpts调节pcr有效果，具体原因需与jintao进一步讨论；

本周：
1.上周余下的其它的Full terble问题
2.小米本地播放丢帧继续分析；
3.其它煲机问题；


./sys/kernel/debug/mali/gpu_memory
./sys/module/mali/parameters/gpu_dbg_level
./sys/module/gpu_clk
./proc/device-tree/thermal-zones/soc_thermal/cooling-maps/gpucore_cooling_map
./proc/device-tree/thermal-zones/soc_thermal/cooling-maps/gpufreq_cooling_map
./proc/device-tree/aml-sensor@0/thermal_gpu_cores
./proc/device-tree/aml-sensor@0/cooling_devices/gpucore_cool
./proc/device-tree/aml-sensor@0/cooling_devices/gpufreq_cool



amlvideo  这边消耗是受上层apk 同步控制的
apk 同步完 提交sf 显示 hwc 那边设置omx 到amvideo 更新系统时间
加大buffer个数 是多点缓存 对抗系统短时间的负载高


1)
p212
osd显示
p212_vp9_sf_kodi.log
Tasks: 217 total,   1 running, 213 sleeping,   0 stopped,   2 zombie                                                                                                   
Mem:   2038400k total,  1740288k used,   298112k free,    29684k buffers                                                                                               
Swap:   511996k total,        0k used,   511996k free,   899920k cached                                                                                                
400%cpu  80%user   0%nice  66%sys 254%idle   0%iow   0%irq   0%sirq   0%host                                                                                           
  PID USER         PR  NI VIRT  RES  SHR S[%CPU] %MEM     TIME+ ARGS                                                                                                   
 4671 u0_a50       10 -10 2.0G 171M 114M S 57.6   8.5   0:41.15 org.xbmc.kodi
 2707 system       -2  -8 141M  14M  11M S 41.3   0.7   0:13.80 surfaceflinger
 2791 mediacodec   20   0  60M  13M  10M S 19.0   0.6   0:02.86 media.codec hw/android.hardware.media.omx@1.0-service
 2693 system       -3  -8  95M 8.2M 6.6M S  8.0   0.4   0:03.71 android.hardware.graphics.composer@2.1-service
 2906 system       18  -2 2.2G 174M 126M S  4.3   8.7   0:59.18 system_server
 2684 audioserver  20   0  25M 7.8M 6.7M S  4.3   0.3   0:05.17 android.hardware.audio@2.0-service
 3065 system       20   0 2.1G  66M  53M S  3.6   3.3   0:14.39 com.droidlogic
 4827 root         20   0  10M 3.6M 2.8M R  3.3   0.1   0:00.34 top
 2776 audioserver  20   0  47M  14M  12M S  3.3   0.7   0:04.82 audioserver
 2555 root         RT   0    0    0    0 D  3.0   0.0   0:01.14 [vdec-core]

 video层显示
 Tasks: 215 total,   1 running, 211 sleeping,   0 stopped,   2 zombie                                                                                                   
Mem:   2038400k total,  1757400k used,   281000k free,    30052k buffers                                                                                               
Swap:   511996k total,        0k used,   511996k free,   955596k cached                                                                                                
400%cpu  48%user   2%nice  56%sys 294%idle   0%iow   0%irq   0%sirq   0%host                                                                                           
  PID USER         PR  NI VIRT  RES  SHR S[%CPU] %MEM     TIME+ ARGS                                                                                                   
 4671 u0_a50       10 -10 1.9G 163M 105M S 35.0   8.1   1:48.19 org.xbmc.kodi
 2791 mediacodec   20   0  42M  13M  10M S 26.6   0.6   0:21.99 media.codec hw/android.hardware.media.omx@1.0-service
 2707 system       -2  -8 124M  14M  11M S 14.3   0.7   0:51.56 surfaceflinger
 2693 system       -3  -8  77M 8.2M 6.6M S  4.6   0.4   0:11.49 android.hardware.graphics.composer@2.1-service
   33 root         20   0    0    0    0 S  4.0   0.0   0:02.02 [kworker/u8:2]
 2906 system       18  -2 2.2G 179M 134M S  3.3   9.0   1:05.52 system_server
 2776 audioserver  20   0  47M  14M  11M S  3.3   0.7   0:09.05 audioserver
 4884 root         20   0  10M 3.4M 2.7M R  3.0   0.1   0:00.14 top
 2684 audioserver  20   0  25M 7.6M 6.5M S  3.0   0.3   0:09.79 android.hardware.audio@2.0-service
 2555 root         RT   0    0    0    0 D  3.0   0.0   0:04.04 [vdec-core]
 2617 logd         30  10  20M 4.6M 2.5M S  2.6   0.2   0:06.76 logd
 3065 system       20   0 2.1G  68M  55M S  2.0   3.4   0:17.46 com.droidlogic
 4423 root         20   0    0    0    0 S  1.6   0.0   0:02.21 [kworker/u8:4]
  199 root         20   0    0    0    0 S  1.6   0.0   0:02.47 [kworker/u8:3]
 2554 root         RT   0    0    0    0 S  1.0   0.0   0:01.44 [irq/158-vdec-1]
 2855 root         20   0    0    0    0 S  0.6   0.0   0:00.92 [aml_buf_toggle]
 1269 root         20   0    0    0    0 S  0.6   0.0   0:06.22 [kworker/0:1]
    7 root         20   0    0    0    0 S  0.6   0.0   0:01.72 [rcu_preempt]
 2792 mdnsr        20   0 5.4M 1.1M 924K S  0.3   0.0   0:00.16 mdnsd
 4830 root         20   0    0    0    0 S  0.0   0.0   0:00.00 [kworker/0:0]
 4829 root         20   0    0    0    0 S  0.0   0.0   0:00.00 [kworker/1:0]
 4828 root         20   0    0    0    0 S  0.0   0.0   0:00.00 [kworker/3:0]
 4812 root          0 -20    0    0    0 S  0.0   0.0   0:00.00 [codec_mm_sc]
 4693 root         20   0    0    0    0 S  0.0   0.0   0:00.00 [kworker/2:3]
 4632 u0_a4        20   0 2.1G  43M  31M S  0.0   2.1   0:00.12 com.android.defcontainer
 4588 system       20   0 2.1G  39M  28M S  0.0   1.9   0:00.06 com.droidlogic.readlog
 4571 u0_a10       20   0 2.1G  43M  32M S  0.0   2.1   0:00.10 com.android.externalstorage
 
 p241
 top
 Tasks: 214 total,   5 running, 207 sleeping,   0 stopped,   2 zombie                                                                                                   
Mem:   1008960k total,   967688k used,    41272k free,    17492k buffers                                                                                               
Swap:   511996k total,       40k used,   511956k free,   381432k cached                                                                                                
400%cpu 153%user   6%nice 135%sys 106%idle   0%iow   0%irq   0%sirq   0%host                                                                                           
  PID USER         PR  NI VIRT  RES  SHR S[%CPU] %MEM     TIME+ ARGS                                                                                                   
 3969 u0_a46       10 -10 1.5G 142M  94M R  109  14.4   1:09.58 org.xbmc.kodi
 2724 system       -2  -8  77M  12M 9.3M S 60.6   1.2   0:38.33 surfaceflinger
 2767 mediacodec   20   0  60M  14M  10M S 48.0   1.3   0:21.92 media.codec hw/android.hardware.media.omx@1.0-service
 2712 system       -3  -8  62M 6.9M 5.6M S 14.0   0.7   0:09.48 android.hardware.graphics.composer@2.1-service
 2703 audioserver  20   0  24M 8.0M 6.8M S 10.6   0.8   0:10.83 android.hardware.audio@2.0-service
 2920 system       18  -2 1.4G 131M 111M S  9.6  13.2   2:08.73 system_server
 2637 logd         30  10  12M 2.4M 1.5M S  9.3   0.2   0:08.24 logd
 2749 audioserver  20   0  42M  14M  11M S  8.0   1.4   0:10.69 audioserver
 4106 root         20   0 5.7M 2.9M 2.2M R  7.6   0.3   0:02.21 top
 3077 system       20   0 1.3G  58M  49M S  4.3   5.9   0:54.99 com.droidlogic
 2573 root         RT   0    0    0    0 S  3.0   0.0   0:01.19 [irq/162-vdec-1]
    6 root         20   0    0    0    0 S  3.0   0.0   0:01.40 [kworker/u8:0]
 4072 root         20   0    0    0    0 R  2.3   0.0   0:00.59 [kworker/u8:4]
 3963 root         20   0    0    0    0 R  2.0   0.0   0:01.10 [kworker/u8:3]
 1798 root         20   0    0    0    0 S  1.6   0.0   0:02.64 [ge2d_monitor]
 4099 root         20   0    0    0    0 S  1.3   0.0   0:00.36 [ionvideo-000]
 2574 root         RT   0    0    0    0 S  1.3   0.0   0:03.94 [vdec-core]
    7 root         20   0    0    0    0 S  1.3   0.0   0:02.61 [rcu_preempt]
 2854 root         20   0    0    0    0 R  1.0   0.0   0:00.70 [aml_buf_toggle]
 3694 root          0 -20    0    0    0 S  0.6   0.0   0:00.20 [kworker/u9:1]
 1742 root         20   0    0    0    0 S  0.6   0.0   0:06.40 [kworker/0:2]
 1268 root         20   0    0    0    0 S  0.6   0.0   0:10.24 [kworker/2:1]
 4059 root         20   0    0    0    0 S  0.3   0.0   0:00.41 [kworker/3:0]
 3366 root         -2   0    0    0    0 S  0.3   0.0   0:03.40 [dhd_dpc]
 2765 wifi         20   0 7.9M 3.6M 2.9M S  0.3   0.3   0:01.18 wificond
 2717 system       20   0 8.1M 3.3M 2.8M S  0.3   0.3   0:00.35 android.hardware.power@1.0-service
 
 video显示
 Tasks: 214 total,   2 running, 209 sleeping,   0 stopped,   2 zombie                                                                                                   
Mem:   1008960k total,   947776k used,    61184k free,    12160k buffers                                                                                               
Swap:   511996k total,        0k used,   511996k free,   440080k cached                                                                                                
400%cpu 126%user   2%nice 106%sys 166%idle   0%iow   0%irq   1%sirq   0%host                                                                                           
  PID USER         PR  NI VIRT  RES  SHR S[%CPU] %MEM     TIME+ ARGS                                                                                                   
 4024 u0_a46       10 -10 1.4G 150M 102M S 78.0  15.1   0:21.24 org.xbmc.kodi
 2724 system       -2  -8  61M  12M 9.2M S 53.3   1.2   0:13.65 surfaceflinger
 2763 mediacodec   20   0  42M  14M 9.4M S 45.0   1.3   0:04.99 media.codec hw/android.hardware.media.omx@1.0-service
 2713 system       -3  -8  44M 6.8M 5.6M S 14.3   0.6   0:04.09 android.hardware.graphics.composer@2.1-service
 2918 system       18  -2 1.3G 122M 101M S  6.3  12.4   1:29.13 system_server
 2704 audioserver  20   0  25M 7.6M 6.4M S  6.3   0.7   0:05.24 android.hardware.audio@2.0-service
 4142 root         20   0 5.7M 2.9M 2.2M R  6.0   0.2   0:00.60 top
 2745 audioserver  20   0  41M  14M  12M S  5.6   1.4   0:04.33 audioserver
 2638 logd         30  10  12M 2.5M 1.6M S  5.0   0.2   0:04.33 logd
    6 root         20   0    0    0    0 S  4.3   0.0   0:00.75 [kworker/u8:0]
   29 root         20   0    0    0    0 S  3.6   0.0   0:00.72 [kworker/u8:1]
 3080 system       20   0 1.3G  71M  62M S  3.3   7.2   0:32.52 com.droidlogic
   33 root         20   0    0    0    0 S  2.3   0.0   0:00.56 [kworker/u8:2]
 2574 root         RT   0    0    0    0 S  1.6   0.0   0:00.16 [irq/162-vdec-1]
 4141 root          0 -20    0    0    0 S  1.0   0.0   0:00.03 [kworker/u9:2]
 2575 root         RT   0    0    0    0 D  1.0   0.0   0:02.09 [vdec-core]
   10 root         RT   0    0    0    0 S  1.0   0.0   0:00.03 [migration/0]
    7 root         20   0    0    0    0 R  1.0   0.0   0:01.61 [rcu_preempt]
 2860 root         20   0    0    0    0 S  0.6   0.0   0:00.27 [aml_buf_toggle]


2)
	Line 76: [   76.842769@0] codec:system_time=-267001, omx_pts=3000, diff=-270001
	Line 122: [  137.826097@0] codec:system_time=5487000, omx_pts=0, diff=5487000
	
	Line 62: [  682.925193@0] codec:system_time=0, omx_pts=3000, diff=-3000
	Line 63: [  682.941894@0] codec:system_time=-267001, omx_pts=3000, diff=-270001
	Line 64: [  683.025106@0] codec:system_time=10500, omx_pts=4501, diff=5999
	Line 80: [  712.925111@0] codec:system_time=2695501, omx_pts=2689500, diff=6001
	Line 114: [  742.525093@0] codec:system_time=5352000, omx_pts=0, diff=5352000
	Line 117: [  742.591743@0] codec:system_time=6000, omx_pts=0, diff=6000
	
	

20171226
vdec.h264.00(1) amlvideo(1) deinterlace(1) amvideo	

echo 0x20000 > /sys/module/amvideo/parameters/debug_flag
echo 0x400000 > /sys/module/amvideo/parameters/debug_flag

echo dump vdec.h264.00 > /sys/class/vfm/map && echo dump amlvideo > /sys/class/vfm/map && echo dump deinterlace > /sys/class/vfm/map


	
--author=gitster	

6.0 leak
756f1fee04ed5dd2da64772fadd00e5d08fed80a
4cb65ce6bbc0f251710666f53f1e8877e6a768a6
3ad1d8872df2fd52964d75135bc725f15ea0e228
2745c7fb18fb99b9a851549e2b79d69cbb284a1f

echo rm default > /sys/class/vfm//
echo add default decoder amlvideo deinterlace amvideo > /sys/class/vfm/map
echo add default vdec.h264.00 amlvideo  amvideo > /sys/class/vfm/map
	
echo 0x02 > /sys/module/amvideo/parameters/video_dbg_vf
echo 0 > /sys/module/amvideo/parameters/debug_flag
echo 0x400000 > /sys/module/amvideo/parameters/debug_flag

每一个vsync显示一帧
echo 0x400002 > /sys/module/amvideo/parameters/debug_flag
echo 0x20000 > /sys/module/amvideo/parameters/debug_flag
echo 0x420000 > /sys/module/amvideo/parameters/debug_flag



[ 1176.862363@0] codec:system_time=157051, omx_pts=154801, diff=2250

[ 1176.879033@0] codec:system_time=157051, omx_pts=154801, diff=2250

[ 1176.887255@3] codec:omx_need_drop_frame_num 0
[ 1176.895697@0] codec:system_time=157051, omx_pts=313201, diff=-156150
[ 1176.895720@0] codec:amlvideo vfpts=313200
[ 1176.895857@0] codec:vpts = 0x0, c.dur=0x780, n.pts=0x4c770, scr = 0xa8c0,ret=0,omxpts=313201


[  354.099448@0] codec:amlvideo vfpts=313200
[  354.099456@0] codec:vdec.h264.00_pool_size=64
[  354.099460@0] codec:vdec.h264.00 buf_free_num=62
[  354.099464@0] codec:vdec.h264.00 buf_avail_num=1
[  354.099468@0] codec:amlvideo_pool_size=16
[  354.099472@0] codec:amlvideo buf_free_num=15
[  354.099476@0] codec:amlvideo buf_avail_num=1
[  354.099482@0] codec:deinterlace_pool_size=10
[  354.099486@0] codec:deinterlace buf_free_num=0
[  354.099490@0] codec:deinterlace buf_avail_num=0

[  354.366095@0] codec:amlvideo vfpts=0
[  354.366102@0] codec:vdec.h264.00_pool_size=64
[  354.366106@0] codec:vdec.h264.00 buf_free_num=26
[  354.366110@0] codec:vdec.h264.00 buf_avail_num=35
[  354.366114@0] codec:amlvideo_pool_size=16
[  354.366118@0] codec:amlvideo buf_free_num=14
[  354.366122@0] codec:amlvideo buf_avail_num=2
[  354.366127@0] codec:deinterlace_pool_size=10
[  354.366131@0] codec:deinterlace buf_free_num=4
[  354.366134@0] codec:deinterlace buf_avail_num=0



解码输出一帧 -> flush -> slepp 100ms -> 解码输出一帧 -> flush ...


12-28 09:15:27.727  2768  3961 V AmlogicVideoDecoderAwesome: reset:265 >
12-28 09:15:27.728  2768  3961 D AmlogicVideoDecoderAwesome: reset_1
12-28 09:15:27.729  2768  3961 I amcodec : AMSTREAM_SET_OMX_RUNNING ret=0
12-28 09:15:27.849  2768  3961 I amcodec : [codec_reset:1075]ret=0
12-28 09:15:27.852  2768  3961 D AmlogicVideoDecoderAwesome: reset_2
12-28 09:15:27.852  2768  3961 D AmlogicVideoDecoderAwesome: mDTaskStatus=1
12-28 09:15:27.852  2768  3961 V AmlogicVideoDecoderAwesome: start:233 >
12-28 09:15:27.852  2768  3961 E ThreadWorker: pthread on exit wait clean
12-28 09:15:27.853  2768  3961 D AmlogicVideoDecoderAwesome: mVideo start
12-28 09:15:27.853  2768  3961 V AmlogicVideoDecoderAwesome: flushInput:762 >
12-28 09:15:27.853  2768  3961 I OmxComponent: OMX.amlogic.avc.decoder.awesome: flush output
12-28 09:15:27.853  2768  4032 V OMX_WorkerPeer: hardware/amlogic/omx/omx_framework/WorkerPeer.cpp:runWorkerStatic:152 --------------------
12-28 09:15:27.853  2768  3961 V AmlogicVideoDecoderAwesome: flushOutput:765 >
12[  131.613523@3] 0: mb height/widht/total: 44/78/1fe0 level_idc 0 max_ref_num 2
-28 09:15:27.853  2768  4032 V OMX_WorkerPeer: hardware/amlogic/omx/omx_framework/WorkerPeer.cpp:runWorker:158 --------------------
12-28 09:15:27.853  2768  3961 V AmlogicVideoDecoderAwesome: flushOutput:818 >
12-28 09:15:27.924  2768  4032 D AmlogicVideoDecoderAwesome: =7, =1920, =1080, =0, =0, =14556199, =14597910, =14639621, =139279, =162859, =178138





while true; do echo m > /proc/sysrq-trigger; cat /proc/pagetrace; cat /proc/slabinfo; dumpsys meminfo;cat /sys/class/decoder_bmmu_box/box_dump; cat /sys/class/codec_mm/codec_mm_dump;sleep 1; done &
while true; do dumpsys meminfo;cat /sys/class/decoder_bmmu_box/box_dump; cat /sys/class/codec_mm/codec_mm_dump; done &
while true; do free; cat /sys/class/codec_mm/codec_mm_dump; done &

Tasks: 210 total,   4 running, 204 sleeping,   0 stopped,   2 zombie                                                                                                   
Mem:   1009276k total,   948328k used,    60948k free,     1184k buffers                                                                                               
Swap:   511996k total,     3528k used,   508468k free,   337676k cached                                                                                                
400%cpu 196%user   1%nice 128%sys  75%idle   0%iow   0%irq   0%sirq   0%host                                                                                           
  PID USER         PR  NI VIRT  RES  SHR S[%CPU] %MEM     TIME+ ARGS                                                                                                   
 3934 u0_a50       10 -10 1.5G 169M  95M S  175  17.1   0:37.02 org.xbmc.kodi
 2700 system       -2  -8 105M  12M 9.0M R 58.6   1.1   0:13.40 surfaceflinger
 2781 mediacodec   20   0  61M  13M  10M S 25.3   1.3   0:05.18 media.codec hw/android.hardware.media.omx@1.0-service
 2686 system       -3   0  62M 6.5M 5.3M S 15.0   0.6   0:03.77 android.hardware.graphics.composer@2.1-service
 2899 system       18  -2 1.3G 104M  79M S 10.0  10.5   1:00.05 system_server
 2678 audioserver  20   0  25M 7.0M 5.8M S  8.0   0.7   0:02.57 android.hardware.audio@2.0-service
 3926 root         20   0 5.7M 2.8M 2.1M R  7.3   0.2   0:02.37 top
 2758 audioserver  20   0  47M  14M  11M S  5.3   1.3   0:02.45 audioserver
 3061 system       20   0 1.3G  53M  44M S  4.6   5.3   0:23.02 com.droidlogic
 2546 root         RT   0    0    0    0 S  3.0   0.0   0:00.39 [irq/162-vdec-1]
  474 root         20   0    0    0    0 R  2.6   0.0   0:00.84 [kworker/u8:3]
 2547 root         RT   0    0    0    0 S  2.0   0.0   0:01.46 [vdec-core]
    6 root         20   0    0    0    0 S  2.0   0.0   0:00.75 [kworker/u8:0]
 4027 root          0 -20    0    0    0 S  1.3   0.0   0:00.00 [kworker/u9:2]
   32 root         20   0    0    0    0 S  1.3   0.0   0:00.61 [kworker/u8:2]
    7 root         20   0    0    0    0 S  1.3   0.0   0:00.70 [rcu_preempt]
 2838 root         20   0    0    0    0 S  1.0   0.0   0:00.28 [aml_buf_toggle]
 2831 root         20   0    0    0    0 S  0.6   0.0   0:03.63 [kworker/1:2]
 2786 mdnsr        20   0 2.1M 932K 648K S  0.6   0.0   0:01.12 mdnsd
 1767 root         20   0    0    0    0 S  0.6   0.0   0:01.76 [ge2d_monitor]
 1709 root         20   0    0    0    0 R  0.6   0.0   0:03.66 [kworker/0:2]
 4003 root          0 -20    0    0    0 S  0.3   0.0   0:00.18 [kworker/u9:1]
 2610 logd         30  10  14M 3.0M 1.8M S  0.3   0.3   0:04.11 logd
 1784 root         20   0    0    0    0 S  0.3   0.0   0:01.37 [kthread_di]
 1240 root         20   0    0    0    0 S  0.3   0.0   0:01.44 [kworker/2:1]
 3995 root         20   0    0    0    0 S  0.0   0.0   0:00.00 [kworker/0:3]
 3846 u0_a8        20   0 1.3G  30M  22M S  0.0   3.0   0:00.10 android.ext.services
 
 
1.手机CPU负载过大，短时间内CPU产生的热量不能散发出去，所以就会造成手机死机
2.运行内存不足
3.手机内存占用过多



